import{_ as e,o as t,c as o,a as i}from"./app.5b251123.js";const n={},a=i(`<h2 id="transacation-4-2" tabindex="-1"><a class="header-anchor" href="#transacation-4-2" aria-hidden="true">#</a> Transacation 4.2</h2><ul><li>\u6682\u65F6\u65E0\u6CD5\u5728\u4E8B\u52A1\u4E2D\u521B\u5EFA\u96C6\u5408</li><li>\u4E8B\u52A1\u4E2D\u4E0D\u80FD\u4F7F\u7528\u4E0D\u540C client</li></ul><h2 id="install-mongodb-4-2" tabindex="-1"><a class="header-anchor" href="#install-mongodb-4-2" aria-hidden="true">#</a> <a href="https://docs.mongodb.com/v4.2/tutorial/install-mongodb-on-ubuntu/" target="_blank" rel="noopener noreferrer">Install mongodb 4.2</a></h2><h3 id="ubuntu-18-04" tabindex="-1"><a class="header-anchor" href="#ubuntu-18-04" aria-hidden="true">#</a> Ubuntu 18.04</h3><h4 id="\u5378\u8F7D" tabindex="-1"><a class="header-anchor" href="#\u5378\u8F7D" aria-hidden="true">#</a> \u5378\u8F7D</h4><p><code>sudo apt-get purge mongodb-org*</code></p><h4 id="\u505C\u6B62" tabindex="-1"><a class="header-anchor" href="#\u505C\u6B62" aria-hidden="true">#</a> \u505C\u6B62</h4><p><code>sudo service mongod stop</code></p><h4 id="\u5220\u9664\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#\u5220\u9664\u6570\u636E" aria-hidden="true">#</a> \u5220\u9664\u6570\u636E</h4><p><code>sudo rm -r /var/log/mongodb</code><code>sudo rm -r /var/lib/mongodb</code></p><h4 id="\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5" aria-hidden="true">#</a> \u5B89\u88C5</h4><h5 id="import-the-public-key-used-by-the-package-management-system" tabindex="-1"><a class="header-anchor" href="#import-the-public-key-used-by-the-package-management-system" aria-hidden="true">#</a> Import the public key used by the package management system</h5><ul><li>\u6DFB\u52A0 MongoDB public GPG\uFF1A</li></ul><p><code>wget -qO - https://www.mongodb.org/static/pgp/server-4.4.asc | sudo apt-key add -</code></p><ul><li>\u5B89\u88C5 gnupg \u53CA\u5176\u4F9D\u8D56\u5E93</li></ul><p><code>sudo apt-get install gnupg</code></p><ul><li>\u5B89\u88C5\u540E\u91CD\u65B0\u5BFC\u5165\u5BC6\u94A5</li></ul><p><code>wget -qO - https://www.mongodb.org/static/pgp/server-4.4.asc | sudo apt-key add -</code></p><h5 id="create-a-list-file-for-mongodb" tabindex="-1"><a class="header-anchor" href="#create-a-list-file-for-mongodb" aria-hidden="true">#</a> Create a list file for MongoDB</h5><ul><li>Create the <code>/etc/apt/sources.list.d/mongodb-org-4.2.list</code> file for Ubuntu 18.04 (Bionic):</li></ul><p><code>echo &quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-4.2.list</code></p><ul><li>Reload local package database.</li></ul><p><code>sudo apt-get update</code></p><ul><li>Install the MongoDB packages.</li></ul><p><code>sudo apt-get install -y mongodb-org=4.4.1 mongodb-org-server=4.4.1 mongodb-org-shell=4.4.1 mongodb-org-mongos=4.4.1 mongodb-org-tools=4.4.1</code></p><h4 id="\u542F\u52A8" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8" aria-hidden="true">#</a> \u542F\u52A8</h4><p><code>sudo service mongod start</code></p><h4 id="\u67E5\u770B\u72B6\u6001" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770B\u72B6\u6001" aria-hidden="true">#</a> \u67E5\u770B\u72B6\u6001</h4><p><code>sudo service mongod status</code></p><h5 id="\u521B\u5EFA\u8D26\u53F7" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u8D26\u53F7" aria-hidden="true">#</a> \u521B\u5EFA\u8D26\u53F7</h5><p><code>db.createUser({user:&quot;admin&quot;, pwd:&quot;admin111&quot;, roles:[{role:&quot;root&quot;, db:&quot;admin&quot;}]})</code></p><h5 id="\u8FDC\u7A0B\u8FDE\u63A5" tabindex="-1"><a class="header-anchor" href="#\u8FDC\u7A0B\u8FDE\u63A5" aria-hidden="true">#</a> \u8FDC\u7A0B\u8FDE\u63A5</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/mongod.conf

net:
  port: <span class="token number">27017</span>  <span class="token comment"># \u7AEF\u53E3</span>
  bindIp: <span class="token number">0.0</span>.0.0  <span class="token comment"># \u5141\u8BB8\u8BBF\u95EE\u7684\u5730\u5740\uFF0C0.0.0.0\u8868\u793A\u6240\u6709</span>

security:
  authorization: enabled
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="export-and-import" tabindex="-1"><a class="header-anchor" href="#export-and-import" aria-hidden="true">#</a> export And import</h2><p>https://docs.mongodb.com/v4.2/reference/program/mongoimport/ https://www.mongodb.org.cn/manual/197.html <code>/exportMongodbData --collection=&lt;collectionName&gt; --pretty --query=&#39;{ &quot;\\_id&quot; : {&quot;$oid&quot;:&quot;xxxx&quot;}, &quot;isDeleted&quot;: false ,&quot;createdAt&quot; : {&quot;$gt&quot;:{&quot;$date&quot;:&quot;2021-01-01T01:09:28.810Z&quot;}}}&#39; --type=json &lt;dbName&gt;</code></p><h2 id="go-mongodb-driver-2020-09-30" tabindex="-1"><a class="header-anchor" href="#go-mongodb-driver-2020-09-30" aria-hidden="true">#</a> go-mongodb-driver (2020/09/30)</h2><h3 id="clientoptions" tabindex="-1"><a class="header-anchor" href="#clientoptions" aria-hidden="true">#</a> ClientOptions</h3><h4 id="appname" tabindex="-1"><a class="header-anchor" href="#appname" aria-hidden="true">#</a> AppName</h4><blockquote><p>AppName specifies an application name that is sent to the server when creating new connections. It is used by the server to log connection and profiling information (e.g. slow query logs). This can also be set through the &quot;appName&quot; URI option (e.g appName=example_application&quot;). The default is empty, meaning no app name will be sent.</p></blockquote><h4 id="auth" tabindex="-1"><a class="header-anchor" href="#auth" aria-hidden="true">#</a> Auth</h4><blockquote><p>Auth specifies a Credential containing options for configuring authentication. See the options.Credential documentation for more information about Credential fields. The default is an empty Credential, meaning no authentication will be configured.</p></blockquote><h4 id="compressors" tabindex="-1"><a class="header-anchor" href="#compressors" aria-hidden="true">#</a> Compressors</h4><blockquote><p>Compressors sets the compressors that can be used when communicating with a server. Valid values are:</p><ol><li>&quot;snappy&quot; - requires server version &gt;= 3.4</li><li>&quot;zlib&quot; - requires server version &gt;= 3.6</li><li>&quot;zstd&quot; - requires server version &gt;= 4.2, and driver version &gt;= 1.2.0 with cgo support enabled or driver version &gt;= 1.3.0 without cgo</li></ol><p>If this option is specified, the driver will perform a negotiation with the server to determine a common list of of compressors and will use the first one in that list when performing operations. See https://docs.mongodb.com/manual/reference/program/mongod/#cmdoption-mongod-networkmessagecompressors for more information about configuring compression on the server and the server-side defaults. This can also be set through the &quot; compressors&quot; URI option (e.g. &quot;compressors=zstd,zlib,snappy&quot;). The default is an empty slice, meaning no compression will be enabled.</p></blockquote><h4 id="connecttimeout" tabindex="-1"><a class="header-anchor" href="#connecttimeout" aria-hidden="true">#</a> ConnectTimeout</h4><blockquote><p>ConnectTimeout specifies a timeout that is used for creating connections to the server. If a custom Dialer is specified through SetDialer, this option must not be used. This can be set through ApplyURI with the &quot; connectTimeoutMS&quot; (e.g &quot;connectTimeoutMS=30&quot;) option. If set to 0, no timeout will be used. The default is 30 seconds.</p></blockquote><h4 id="dialer" tabindex="-1"><a class="header-anchor" href="#dialer" aria-hidden="true">#</a> Dialer</h4><blockquote><p>Dialer specifies a custom ContextDialer to be used to create new connections to the server. The default is a net.Dialer with the Timeout field set to ConnectTimeout. See https://golang.org/pkg/net/#Dialer for more information about the net.Dialer type.</p></blockquote><h4 id="direct" tabindex="-1"><a class="header-anchor" href="#direct" aria-hidden="true">#</a> Direct</h4><blockquote><p>Direct specifies whether or not a direct connect should be made. If set to true, the driver will only connect to the host provided in the URI and will not discover other hosts in the cluster. This can also be set through the &quot; directConnection&quot; URI option. This option cannot be set to true if multiple hosts are specified, either through ApplyURI or SetHosts, or an SRV URI is used. As of driver version 1.4, the &quot;connect&quot; URI option has been deprecated and replaced with &quot;directConnection&quot;. The &quot; connect&quot; URI option has two values:</p><ol><li>&quot;connect=direct&quot; for direct connections. This corresponds to &quot;directConnection=true&quot;.</li><li>&quot;connect=automatic&quot; for automatic discovery. This corresponds to &quot;directConnection=false&quot;</li></ol><p>If the &quot;connect&quot; and &quot;directConnection&quot; URI options are both specified in the connection string, their values must not conflict. Direct connections are not valid if multiple hosts are specified or an SRV URI is used. The default value for this option is false.</p></blockquote><h4 id="heartbeatinterval" tabindex="-1"><a class="header-anchor" href="#heartbeatinterval" aria-hidden="true">#</a> HeartbeatInterval</h4><blockquote><p>HeartbeatInterval specifies the amount of time to wait between periodic background server checks. This can also be set through the &quot;heartbeatIntervalMS&quot; URI option (e.g. &quot;heartbeatIntervalMS=10000&quot;). The default is 10 seconds.</p></blockquote><h4 id="hosts" tabindex="-1"><a class="header-anchor" href="#hosts" aria-hidden="true">#</a> Hosts</h4><blockquote><p>Hosts specifies a list of host names or IP addresses for servers in a cluster. Both IPv4 and IPv6 addresses are supported. IPv6 literals must be enclosed in &#39;[]&#39; following RFC-2732 syntax. Hosts can also be specified as a comma-separated list in a URI. For example, to include &quot;localhost:27017&quot; and &quot; localhost:27018&quot;, a URI could be &quot;mongodb://localhost:27017,localhost:27018&quot;. The default is [&quot;localhost:27017&quot;]</p></blockquote><h4 id="localthreshold" tabindex="-1"><a class="header-anchor" href="#localthreshold" aria-hidden="true">#</a> LocalThreshold</h4><blockquote><p>LocalThreshold specifies the width of the &#39;latency window&#39;: when choosing between multiple suitable servers for an operation, this is the acceptable non-negative delta between shortest and longest average round-trip times. A server within the latency window is selected randomly. This can also be set through the &quot;localThresholdMS&quot; URI option (e.g. &quot; localThresholdMS=15000&quot;). The default is 15 milliseconds.</p></blockquote><h4 id="maxconnidletime" tabindex="-1"><a class="header-anchor" href="#maxconnidletime" aria-hidden="true">#</a> MaxConnIdleTime</h4><blockquote><p>MaxConnIdleTime specifies the maximum amount of time that a connection will remain idle in a connection pool before it is removed from the pool and closed. This can also be set through the &quot;maxIdleTimeMS&quot; URI option (e.g. &quot; maxIdleTimeMS=10000&quot;). The default is 0, meaning a connection can remain unused indefinitely.</p></blockquote><h4 id="maxpoolsize" tabindex="-1"><a class="header-anchor" href="#maxpoolsize" aria-hidden="true">#</a> MaxPoolSize</h4><blockquote><p>MaxPoolSize specifies that maximum number of connections allowed in the driver&#39;s connection pool to each server.Requests to a server will block if this maximum is reached. This can also be set through the &quot;maxPoolSize&quot; URI option (e.g. &quot;maxPoolSize=100&quot;). The default is 100. If this is 0, it will be set to math.MaxInt64.</p></blockquote><h4 id="minpoolsize" tabindex="-1"><a class="header-anchor" href="#minpoolsize" aria-hidden="true">#</a> MinPoolSize</h4><blockquote><p>MinPoolSize specifies the minimum number of connections allowed in the driver&#39;s connection pool to each server. If this is non-zero, each server&#39;s pool will be maintained in the background to ensure that the size does not fall below the minimum. This can also be set through the &quot;minPoolSize&quot; URI option (e.g. &quot;minPoolSize=100&quot;).</p></blockquote><h4 id="poolmonitor" tabindex="-1"><a class="header-anchor" href="#poolmonitor" aria-hidden="true">#</a> PoolMonitor</h4><blockquote><p>PoolMonitor specifies a PoolMonitor to receive connection pool events. See the event.PoolMonitor documentation for more information about the structure of the monitor and events that can be received.</p></blockquote><h4 id="monitor" tabindex="-1"><a class="header-anchor" href="#monitor" aria-hidden="true">#</a> Monitor</h4><blockquote><p>Monitor specifies a CommandMonitor to receive command events. See the event.CommandMonitor documentation for more information about the structure of the monitor and events that can be received.</p></blockquote><h4 id="readconcern" tabindex="-1"><a class="header-anchor" href="#readconcern" aria-hidden="true">#</a> ReadConcern</h4><blockquote><p>ReadConcern specifies the read concern to use for read operations. A read concern level can also be set through the &quot; readConcernLevel&quot; URI option (e.g. &quot;readConcernLevel=majority&quot;). The default is nil, meaning the server will use its configured default.</p></blockquote><h4 id="readpreference" tabindex="-1"><a class="header-anchor" href="#readpreference" aria-hidden="true">#</a> ReadPreference</h4><blockquote><p>ReadPreference specifies the read preference to use for read operations. This can also be set through the following URI options:</p><ol><li>&quot;readPreference&quot; - Specifiy the read preference mode (e.g. &quot;readPreference=primary&quot;).</li><li>&quot;readPreferenceTags&quot;: Specify one or more read preference tags (e.g. &quot;readPreferenceTags=region:south,datacenter: A&quot;).</li><li>&quot;maxStalenessSeconds&quot; (or &quot;maxStaleness&quot;): Specify a maximum replication lag for reads from secondaries in a replica set (e.g. &quot;maxStalenessSeconds=10&quot;).</li></ol><p>The default is readpref.Primary(). See https://docs.mongodb.com/manual/core/read-preference/#read-preference for more information about read preferences.</p></blockquote><h4 id="registry" tabindex="-1"><a class="header-anchor" href="#registry" aria-hidden="true">#</a> Registry</h4><blockquote><p>Registry specifies the BSON registry to use for BSON marshalling/unmarshalling operations. The default is bson.DefaultRegistry.</p></blockquote><h4 id="replicaset" tabindex="-1"><a class="header-anchor" href="#replicaset" aria-hidden="true">#</a> ReplicaSet</h4><blockquote><p>ReplicaSet specifies the replica set name for the cluster. If specified, the cluster will be treated as a replica set and the driver will automatically discover all servers in the set, starting with the nodes specified through ApplyURI or SetHosts. All nodes in the replica set must have the same replica set name, or they will not be considered as part of the set by the Client. This can also be set through the &quot;replicaSet&quot; URI option (e.g. &quot;replicaSet=replset&quot;). The default is empty.</p></blockquote><h4 id="retrywrites" tabindex="-1"><a class="header-anchor" href="#retrywrites" aria-hidden="true">#</a> RetryWrites</h4><blockquote><p>RetryWrites specifies whether supported write operations should be retried once on certain errors, such as network errors. Supported operations are InsertOne, UpdateOne, ReplaceOne, DeleteOne, FindOneAndDelete, FindOneAndReplace, FindOneAndDelete, InsertMany, and BulkWrite. Note that BulkWrite requests must not include UpdateManyModel or DeleteManyModel instances to be considered retryable. Unacknowledged writes will not be retried, even if this option is set to true. This option requires server version &gt;= 3.6 and a replica set or sharded cluster and will be ignored for any other cluster type. This can also be set through the &quot;retryWrites&quot; URI option (e.g. &quot;retryWrites=true&quot;). The default is true.</p></blockquote><h4 id="retryreads" tabindex="-1"><a class="header-anchor" href="#retryreads" aria-hidden="true">#</a> RetryReads</h4><blockquote><p>RetryReads specifies whether supported read operations should be retried once on certain errors, such as network errors. Supported operations are Find, FindOne, Aggregate without a $out stage, Distinct, CountDocuments, EstimatedDocumentCount, Watch (for Client, Database, and Collection), ListCollections, and ListDatabases. Note that operations run through RunCommand are not retried. This option requires server version &gt;= 3.6 and driver version &gt;= 1.1.0. The default is true.</p></blockquote><h4 id="serverselectiontimeout" tabindex="-1"><a class="header-anchor" href="#serverselectiontimeout" aria-hidden="true">#</a> ServerSelectionTimeout</h4><blockquote><p>ServerSelectionTimeout specifies how long the driver will wait to find an available, suitable server to execute an operation. This can also be set through the &quot;serverSelectionTimeoutMS&quot; URI option (e.g. &quot; serverSelectionTimeoutMS=30000&quot;). The default value is 30 seconds.</p></blockquote><h4 id="sockettimeout" tabindex="-1"><a class="header-anchor" href="#sockettimeout" aria-hidden="true">#</a> SocketTimeout</h4><blockquote><p>SocketTimeout specifies how long the driver will wait for a socket read or write to return before returning a network error. This can also be set through the &quot;socketTimeoutMS&quot; URI option (e.g. &quot;socketTimeoutMS=1000&quot;). The default value is 0, meaning no timeout is used and socket operations can block indefinitely.</p></blockquote><h4 id="tlsconfig" tabindex="-1"><a class="header-anchor" href="#tlsconfig" aria-hidden="true">#</a> TLSConfig</h4><blockquote><p>TLSConfig specifies a tls.Config instance to use use to configure TLS on all connections created to the cluster. This can also be set through the following URI options:</p><ol><li>&quot;tls&quot; (or &quot;ssl&quot;): Specify if TLS should be used (e.g. &quot;tls=true&quot;).</li><li>Either &quot;tlsCertificateKeyFile&quot; (or &quot;sslClientCertificateKeyFile&quot;) or a combination of &quot;tlsCertificateFile&quot; and &quot; tlsPrivateKeyFile&quot;. The &quot;tlsCertificateKeyFile&quot; option specifies a path to the client certificate and private key, which must be concatenated into one file. The &quot;tlsCertificateFile&quot; and &quot;tlsPrivateKey&quot; combination specifies separate paths to the client certificate and private key, respectively. Note that if &quot;tlsCertificateKeyFile&quot; is used, the other two options must not be specified.</li><li>&quot;tlsCertificateKeyFilePassword&quot; (or &quot;sslClientCertificateKeyPassword&quot;): Specify the password to decrypt the client private key file (e.g. &quot;tlsCertificateKeyFilePassword=password&quot;).</li><li>&quot;tlsCaFile&quot; (or &quot;sslCertificateAuthorityFile&quot;): Specify the path to a single or bundle of certificate authorities to be considered trusted when making a TLS connection (e.g. &quot;tlsCaFile=/path/to/caFile&quot;).</li><li>&quot;tlsInsecure&quot; (or &quot;sslInsecure&quot;): Specifies whether or not certificates and hostnames received from the server should be validated. If true (e.g. &quot;tlsInsecure=true&quot;), the TLS library will accept any certificate presented by the server and any host name in that certificate. Note that setting this to true makes TLS susceptible to man-in-the-middle attacks and should only be done for testing. The default is nil, meaning no TLS will be enabled.</li></ol></blockquote><h4 id="writeconcern" tabindex="-1"><a class="header-anchor" href="#writeconcern" aria-hidden="true">#</a> WriteConcern</h4><blockquote><p>WriteConcern specifies the write concern to use to for write operations. This can also be set through the following URI options:</p><ol><li>&quot;w&quot;: Specify the number of nodes in the cluster that must acknowledge write operations before the operation returns or &quot;majority&quot; to specify that a majority of the nodes must acknowledge writes. This can either be an integer ( e.g. &quot;w=10&quot;) or the string &quot;majority&quot; (e.g. &quot;w=majority&quot;).</li><li>&quot;wTimeoutMS&quot;: Specify how long write operations should wait for the correct number of nodes to acknowledge the operation (e.g. &quot;wTimeoutMS=1000&quot;).</li><li>&quot;journal&quot;: Specifies whether or not write operations should be written to an on-disk journal on the server before returning (e.g. &quot;journal=true&quot;). The default is nil, meaning the server will use its configured default.</li></ol></blockquote><h4 id="zliblevel" tabindex="-1"><a class="header-anchor" href="#zliblevel" aria-hidden="true">#</a> ZlibLevel</h4><blockquote><p>specifies the level for the zlib compressor. This option is ignored if zlib is not specified as a compressor through ApplyURI or SetCompressors. Supported values are -1 through 9, inclusive. -1 tells the zlib library to use its default, 0 means no compression, 1 means best speed, and 9 means best compression. This can also be set through the &quot;zlibCompressionLevel&quot; URI option (e.g. &quot;zlibCompressionLevel=-1&quot;). Defaults to -1.</p></blockquote><h4 id="zstdlevel" tabindex="-1"><a class="header-anchor" href="#zstdlevel" aria-hidden="true">#</a> ZstdLevel</h4><blockquote><p>ZstdLevel sets the level for the zstd compressor. This option is ignored if zstd is not specified as a compressor through ApplyURI or SetCompressors. Supported values are 1 through 20, inclusive. 1 means best speed and 20 means best compression. This can also be set through the &quot;zstdCompressionLevel&quot; URI option. Defaults to 6.</p></blockquote><h4 id="autoencryptionoptions" tabindex="-1"><a class="header-anchor" href="#autoencryptionoptions" aria-hidden="true">#</a> AutoEncryptionOptions</h4><blockquote><p>AutoEncryptionOptions specifies an AutoEncryptionOptions instance to automatically encrypt and decrypt commands and their results. See the options.AutoEncryptionOptions documentation for more information about the supported options.</p></blockquote><h4 id="disableocspendpointcheck" tabindex="-1"><a class="header-anchor" href="#disableocspendpointcheck" aria-hidden="true">#</a> DisableOCSPEndpointCheck</h4><blockquote><p>DisableOCSPEndpointCheck specifies whether or not the driver should reach out to OCSP responders to verify the certificate status for certificates presented by the server that contain a list of OCSP responders. If set to true, the driver will verify the status of the certificate using a response stapled by the server, if there // is one, but will not send an HTTP request to any responders if there is no staple. In this case, the driver will continue the connection even though the certificate status is not known. This can also be set through the tlsDisableOCSPEndpointCheck URI option. Both this URI option and tlsInsecure must not be set at the same time and will error if they are. The default value is false.</p></blockquote><h2 id="\u5E38\u7528\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#\u5E38\u7528\u547D\u4EE4" aria-hidden="true">#</a> \u5E38\u7528\u547D\u4EE4</h2><h3 id="ubuntu-\u4F7F\u7528-systemctl-\u547D\u4EE4\u5F3A\u5236\u5BC6\u7801\u9A8C\u8BC1\u767B\u5F55" tabindex="-1"><a class="header-anchor" href="#ubuntu-\u4F7F\u7528-systemctl-\u547D\u4EE4\u5F3A\u5236\u5BC6\u7801\u9A8C\u8BC1\u767B\u5F55" aria-hidden="true">#</a> Ubuntu \u4F7F\u7528 Systemctl \u547D\u4EE4\u5F3A\u5236\u5BC6\u7801\u9A8C\u8BC1\u767B\u5F55</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /lib/systemd/system/mongod.service

systemctl daemon-reload
systemctl restart mongod
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u9884\u5B9A\u4E49\u89D2\u8272" tabindex="-1"><a class="header-anchor" href="#\u9884\u5B9A\u4E49\u89D2\u8272" aria-hidden="true">#</a> \u9884\u5B9A\u4E49\u89D2\u8272</h3><ul><li><p><strong>\u6570\u636E\u5E93\u7528\u6237\u89D2\u8272\uFF08\u6240\u6709\u6570\u636E\u5E93\u90FD\u6709\uFF09</strong></p><ul><li>read \u7528\u6237\u53EF\u4EE5\u8BFB\u53D6\u5F53\u524D\u6570\u636E\u5E93\u7684\u6570\u636E</li><li>readWrite \u7528\u6237\u53EF\u4EE5\u8BFB\u5199\u5F53\u524D\u6570\u636E\u5E93\u7684\u6570\u636E</li></ul></li><li><p><strong>\u6570\u636E\u5E93\u7BA1\u7406\u89D2\u8272\uFF08\u6240\u6709\u6570\u636E\u5E93\u90FD\u6709\uFF09</strong></p><ul><li>dbAdmin \u7BA1\u7406\u5458\u7528\u6237\u4F46\u4E0D\u80FD\u5BF9\u7528\u6237\u548C\u89D2\u8272\u7BA1\u7406\u6388\u6743</li><li>dbOwner \u6570\u636E\u5E93\u6240\u6709\u8005\u53EF\u8FDB\u884C\u4EFB\u4F55\u7BA1\u7406\u4EFB\u52A1</li><li>userAdmin \u53EF\u4EE5\u7BA1\u7406\u5F53\u524D\u6570\u636E\u7684\u7528\u6237\u548C\u89D2\u8272</li></ul></li><li><p><strong>\u96C6\u7FA4\u7BA1\u7406\u89D2\u8272\uFF08admin \u6570\u636E\u5E93\u53EF\u7528\uFF09</strong></p><ul><li>clusterAdmin \u96C6\u7FA4\u6240\u6709\u7BA1\u7406\u6743\u9650\uFF0C\u662F clusterManager\u3001clusterMonitor\u3001hostManager \u5408\u96C6</li><li>clusterManager \u96C6\u7FA4\u7BA1\u7406\u548C\u76D1\u63A7</li><li>clusterMonitor \u96C6\u7FA4\u76D1\u63A7\uFF0C\u53EA\u8BFB\u7684</li><li>hostManager \u76D1\u63A7\u548C\u7BA1\u7406\u670D\u52A1\u5668</li></ul></li><li><p><strong>\u5907\u4EFD\u548C\u6062\u590D\u89D2\u8272\uFF08admin \u6570\u636E\u5E93\u53EF\u7528\uFF09</strong></p><ul><li>backup</li><li>restore</li></ul></li><li><p><strong>\u6240\u6709\u6570\u636E\u5E93\u89D2\u8272\uFF08admin \u6570\u636E\u5E93\u53EF\u7528\uFF09</strong></p><ul><li>readAnyDatabase \u8BFB\u53D6\u6240\u6709\u6570\u636E\u5E93</li><li>readWriteAnyDatabase \u8BFB\u5199\u6240\u6709\u6570\u636E\u5E93</li><li>userAdminAnyDatabase \u6240\u6709\u6570\u636E\u5E93\u7684 userAdmin \u6743\u9650</li><li>dbAdminAnyDatabase \u6240\u6709\u6570\u636E\u5E93\u7684 dbAdmin \u6743\u9650</li></ul></li><li><p><strong>\u8D85\u7EA7\u89D2\u8272\uFF08admin \u6570\u636E\u5E93\u53EF\u7528\uFF09</strong></p><ul><li>root \u8D85\u7EA7\u7528\u6237</li></ul></li><li><p><strong>\u5185\u90E8\u89D2\u8272</strong></p><ul><li>__system \u6240\u6709\u64CD\u4F5C\u6743\u9650</li></ul></li></ul><p>\u66F4\u591A\u9884\u5B9A\u4E49\u89D2\u8272\u4FE1\u606F\u89C1\u6587\u6863 <a href="https://docs.mongodb.com/manual/core/security-built-in-roles/" target="_blank" rel="noopener noreferrer">https://docs.mongodb.com/manual/core/security-built-in-roles/</a></p><h2 id="\u7D22\u5F15" tabindex="-1"><a class="header-anchor" href="#\u7D22\u5F15" aria-hidden="true">#</a> \u7D22\u5F15</h2><p><a href="https://blog.csdn.net/weixin_33446857/article/details/83085018" target="_blank" rel="noopener noreferrer">\u7D22\u5F15</a></p><p>https://www.cnblogs.com/duhuo/articles/4762933.html</p><p>https://zhuanlan.zhihu.com/p/102895029</p><p>https://blog.csdn.net/u013066244/article/details/78961602</p><p>https://www.cnblogs.com/c-abc/p/6023824.html</p><p>https://blog.csdn.net/chigua1760/article/details/100642249</p><h2 id="bulk" tabindex="-1"><a class="header-anchor" href="#bulk" aria-hidden="true">#</a> Bulk</h2><p><a href="https://docs.mongodb.com/manual/core/bulk-write-operations/" target="_blank" rel="noopener noreferrer">Bulk</a></p><h2 id="mongodb-\u6267\u884C-dropdatabase-\u62A5\u9519-not-authorized-on-xxx-to-execute-command-dropdatabase-1-0-db-xxx-\u89E3\u51B3\u529E\u6CD5" tabindex="-1"><a class="header-anchor" href="#mongodb-\u6267\u884C-dropdatabase-\u62A5\u9519-not-authorized-on-xxx-to-execute-command-dropdatabase-1-0-db-xxx-\u89E3\u51B3\u529E\u6CD5" aria-hidden="true">#</a> mongodb \u6267\u884C dropDatabase \u62A5\u9519&quot;not authorized on xxx to execute command { dropDatabase\uFF1A1.0\uFF0C$db:&quot;xxx&quot;}&quot;\u89E3\u51B3\u529E\u6CD5</h2><p>https://www.jianshu.com/u/8eb1d4237939</p><p>2020.11.02 11:38:40 \u5B57\u6570 44 \u9605\u8BFB 40</p><p>\u6B64\u9519\u8BEF\u662F\u56E0\u4E3A\u6CA1\u6709\u6388\u6743\u7ED9 admin \u7528\u6237\u5BF9 system \u6570\u636E\u5E93\u6267\u884C\u547D\u4EE4\u7684\u6743\u9650\uFF0C\u89E3\u51B3\u65B9\u6CD5\u5982\u4E0B:</p><p>db.grantRolesToUser ( &quot;root&quot;, [ { role: &quot;__system&quot;, db: &quot;admin&quot; } ] )</p><h2 id="mongodb-shell-script" tabindex="-1"><a class="header-anchor" href="#mongodb-shell-script" aria-hidden="true">#</a> mongodb shell script</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>var needToUpdate = []
var needToDelete = []
db.getCollection(&#39;ec.storeMemberHistory&#39;).aggregate([
    {
        &quot;$match&quot;: { &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;)}
    },
    {
        &quot;$lookup&quot;: { &quot;from&quot; : &quot;member&quot;, &quot;localField&quot;: &quot;memberId&quot;, &quot;foreignField&quot;: &quot;_id&quot;, &quot;as&quot;: &quot;member&quot;}
    },
    {
        &quot;$match&quot;: {&quot;$or&quot;:[{&quot;member.isDeleted&quot;:true},{&quot;member&quot;:{&quot;$size&quot;:0}}]}
    }
]).forEach(function(history){
    var hasMergeHistory = false;
    db.getCollection(&#39;memberMergeHistory&#39;).aggregate([
        {
            &quot;$match&quot;: { &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;),&quot;mergedMemberIds&quot; : {&quot;$in&quot;:[history.memberId]} }
        },
    ]).forEach(function(mergeHistory){
        hasMergeHistory = true;
        db.getCollection(&#39;ec.storeMemberHistory&#39;).find({
                &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;),
                &quot;memberId&quot;: history.memberId
        }).forEach(function(doc){
             db.getCollection(&#39;ec.storeMemberHistory&#39;).update({_id:doc._id},{&quot;$set&quot;: { &quot;memberId&quot; : mergeHistory.mainMemberId}})
        })
    })
    if (hasMergeHistory){
        needToUpdate.push(history.memberId);
    } else{
        needToDelete.push(history.memberId);
    }
})
needToDelete.forEach(function(memberId){
    db.getCollection(&#39;ec.storeMemberHistory&#39;).remove({
        &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;),
        &quot;memberId&quot; : memberId
    })
})
print(&quot;need update count:&quot; + needToUpdate.length)
print(&quot;need delete count:&quot; + needToDelete.length)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>var needToUpdate = []
var needToDelete = []
db.getCollection(&#39;ec.storeMember&#39;).aggregate([
    {
        &quot;$match&quot;: { &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;), &quot;isDeleted&quot;: false }
    },
    {
        &quot;$lookup&quot;: { &quot;from&quot; : &quot;member&quot;, &quot;localField&quot;: &quot;memberId&quot;, &quot;foreignField&quot;: &quot;_id&quot;, &quot;as&quot;: &quot;member&quot;}
    },
    {
        &quot;$match&quot;: {&quot;$or&quot;:[{&quot;member.isDeleted&quot;:true},{&quot;member&quot;:{&quot;$size&quot;:0}}]}
    }
]).forEach(function(storeMember){
    var hasMergeHistory = false;
    db.getCollection(&#39;memberMergeHistory&#39;).aggregate([
        {
            &quot;$match&quot;: { &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;),&quot;mergedMemberIds&quot; : {&quot;$in&quot;:[storeMember.memberId]} }
        },
    ]).forEach(function(mergeHistory){
        hasMergeHistory = true;
        db.getCollection(&#39;ec.storeMember&#39;).find({
                &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;),
                &quot;memberId&quot;: storeMember.memberId,
                &quot;isDeleted&quot;: false
        }).forEach(function(doc){
             db.getCollection(&#39;ec.storeMember&#39;).update({_id:doc._id},{&quot;$set&quot;: { &quot;memberId&quot; : mergeHistory.mainMemberId}})
        })
    })
    if (hasMergeHistory){
        needToUpdate.push(storeMember.memberId);
    } else{
        needToDelete.push(storeMember.memberId);
    }
})
needToDelete.forEach(function(memberId){
    db.getCollection(&#39;ec.storeMember&#39;).update({
        &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;),
        &quot;memberId&quot; : memberId
    },{&quot;$set&quot;: { &quot;isDeleted&quot; : true}})
})

print(&quot;update count:&quot; + needToUpdate.length)
print(&quot;delete count:&quot; + needToDelete.length)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>db.getCollection(&#39;ec.storeMemberHistory&#39;).aggregate([
    { &quot;$match&quot;: { &quot;accountId&quot;: ObjectId(&#39;5e7872a773ee1200fb1bec32&#39;), &quot;relation&quot;: &quot;bound&quot; } },
    { &quot;$sort&quot;: { &quot;createdAt&quot;: -1 } },
    { &quot;$group&quot;: {
        &quot;_id&quot;: { &quot;storeId&quot;: &quot;$storeId&quot;, &quot;staffId&quot;: &quot;$staffId&quot;, &quot;memberId&quot;: &quot;$memberId&quot; },
        &quot;createdAt&quot;: { &quot;$first&quot;: &quot;$createdAt&quot; },
      },
    },
  ]).forEach(function (history) {
    db.getCollection(&#39;ec.storeMember&#39;).update(
      {
        &quot;accountId&quot;: ObjectId(&#39;5e7872a773ee1200fb1bec32&#39;),
        &quot;memberId&quot;: history._id.memberId,
        &quot;isDeleted&quot;: false,
        &quot;stores&quot;: { &quot;$elemMatch&quot;: { &quot;staffId&quot;: history._id.staffId, &quot;storeId&quot;: history._id.storeId } },
      },
      { &quot;$set&quot;: { &quot;stores.$.boundAt&quot;: history.createdAt } }
    );
  });
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>db.getCollection(&#39;ec.storeMember&#39;).aggregate([
    {&quot;$match&quot;:{&quot;accountId&quot;: ObjectId(&quot;5e7872a773ee1200fb1bec32&quot;)}},
    {
        &quot;$redact&quot;:{
            &quot;$cond&quot;:{
                &quot;if&quot;:{
                    &quot;$or&quot;:[
                        &quot;$stores&quot;,
                        {
                            &quot;$and&quot;:[
                                {&quot;$in&quot;:[&quot;$relation&quot;,[&quot;touched&quot;,&quot;served&quot;]]},
                                {&quot;$lt&quot;:[&quot;$updatedAt&quot;,ISODate(&quot;2021-05-20T08:26:26.773Z&quot;)]},
                                {&quot;$gt&quot;:[&quot;$updatedAt&quot;,ISODate(&quot;2021-04-20T08:26:26.773Z&quot;)]}
                            ]
                        }
                    ]
                },
                &quot;then&quot;:&quot;$$DESCEND&quot;,
                &quot;else&quot;:&quot;$$PRUNE&quot;,
            }
        }
    },
    {&quot;$match&quot;:{&quot;stores&quot;:{&quot;$ne&quot;:[]}}}
])
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>/exportMongodbData --collection=ec.storeMember --pretty --query=&#39;{ &quot;accountId&quot; : {&quot;<span title="ParseError: KaTeX parse error: Expected &#39;EOF&#39;, got &#39;}&#39; at position 32: \u2026d05c5b770b04e8&quot;}\u0332, &quot;
isDeleted&quot;:\u2026">oid&quot;:&quot;601b460bc2d05c5b770b04e8&quot;}, &quot; isDeleted&quot;: false ,&quot;createdAt&quot; : {&quot;</span>gt&quot;:{&quot;$date&quot;:&quot;2021-01-01T01:09:28.810Z&quot;}}}&#39; --type=json portal-tenants-tongrentang</p><h2 id="\u526F\u672C\u96C6" tabindex="-1"><a class="header-anchor" href="#\u526F\u672C\u96C6" aria-hidden="true">#</a> \u526F\u672C\u96C6</h2><h3 id="\u7279\u70B9" tabindex="-1"><a class="header-anchor" href="#\u7279\u70B9" aria-hidden="true">#</a> \u7279\u70B9</h3><ul><li>\u4E3B\u8282\u70B9\u552F\u4E00\uFF1A\u4E3B\u8282\u70B9\u552F\u4E00\uFF0C\u4F46\u662F\u4E0D\u56FA\u5B9A\uFF08\u4E0D\u786E\u5B9A\u7684\u539F\u56E0\u662F\uFF1A\u4E3B\u8282\u70B9\u6302\u4E86\u7684\u8BDD\uFF0C\u4F1A\u91CD\u65B0\u9009\u4E3E\u51FA\u4E00\u4E2A\u4E3B\u8282\u70B9\uFF09</li><li>\u5927\u591A\u6570\u539F\u5219\uFF1A\u5927\u591A\u6570\u539F\u5219\uFF0C\u53731/2\u539F\u5219\uFF0C\u4E00\u4E2A\u590D\u5236\u96C6\u96C6\u7FA4\u4E2D\uFF0C\u5982\u679C\u6709\u5927\u4E8E\u7B49\u4E8E1/2\u7684\u8282\u70B9\u4E0D\u53EF\u7528\u7684\u8BDD\uFF0C\u90A3\u4E48\u6574\u4E2A\u8FDB\u7FA4\u5C06\u4E0D\u53EF\u5199\uFF0C\u53EA\u53EF\u8BFB</li><li>\u4ECE\u5E93\u65E0\u6CD5\u5199\u5165</li><li>\u526F\u672C\u96C6\u53EF\u4EE5\u81EA\u52A8\u8FDB\u884C\u5BB9\u707E</li></ul><h3 id="\u642D\u5EFA" tabindex="-1"><a class="header-anchor" href="#\u642D\u5EFA" aria-hidden="true">#</a> \u642D\u5EFA</h3><h4 id="\u524D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u524D\u7F6E" aria-hidden="true">#</a> \u524D\u7F6E</h4><ul><li><p>\u7CFB\u7EDF Ubuntu Server 18.04</p></li><li><p>\u7248\u672C mongodb 4.2.15</p></li><li><p>\u89D2\u8272\u5206\u914D</p><table><thead><tr><th style="text-align:center;">xxx</th><th style="text-align:center;">xxx</th><th style="text-align:center;">xxx</th></tr></thead><tbody><tr><td style="text-align:center;">Primary</td><td style="text-align:center;">&lt;host1&gt;:27017</td><td style="text-align:center;">\u4E3B\u8282\u70B9 \u8D1F\u8D23\u8BFB\u5199</td></tr><tr><td style="text-align:center;">Secondary</td><td style="text-align:center;">&lt;host2&gt;:27017</td><td style="text-align:center;">\u4ECE\u8282\u70B9,\u8D1F\u8D23\u5BB9\u707E,\u4E3B\u8282\u70B9\u6302\u6389,\u5219\u4ECE\u8282\u70B9\u6210\u4E3A\u4E3B\u8282\u70B9</td></tr><tr><td style="text-align:center;">Arbiter</td><td style="text-align:center;">&lt;host1&gt;:27017</td><td style="text-align:center;">\u6295\u7968\u8282\u70B9,\u4E0D\u8D1F\u8D23\u6570\u636E\u7684\u5B58\u50A8\u8BFB\u5199,\u5B58\u5728\u7684\u610F\u4E49\u662F,\u9075\u5FAA\u4E0Bmongo\u590D\u5236\u96C6\u76841/2\u539F\u5219</td></tr></tbody></table></li></ul><h4 id="\u5B89\u88C5-1" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5-1" aria-hidden="true">#</a> \u5B89\u88C5</h4><p>\u914D\u7F6E</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>storage:
  dbPath: /var/lib/mongodb #mongo \u6570\u636E\u76EE\u5F55
  journal:
    enabled: true
systemLog:
  destination: file
  logAppend: true
  path: /var/log/mongodb/mongod.log #\u65E5\u5FD7\u76EE\u5F55
net:
  port: 27017
  bindIp: 0.0.0.0
processManagement:
  timeZoneInfo: /usr/share/zoneinfo
security:
  keyFile: /var/lib/mongodb/auth.key
  authorization: enabled
replication:
  replSetName: rs0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>dockerfile</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>FROM mongo:4.2.17-bionic

COPY config/auth.key /app/auth.key
RUN chown -R mongodb:mongodb /app/auth.key
RUN chmod 600 /app/auth.key #\u5FC5\u987B\u8BBE\u7F6E\u79D8\u94A5\u6587\u4EF6\u6743\u9650
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>docker-compose.yml</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>version: &#39;3&#39;
services:
  alomerry-mongodb-rs1:
    image: mongo-replset-4.2.17-bionic
    volumes:
      - /home/ubuntu/document/mongodb/db/rs1:/var/lib/mongodb:rw
      - /home/ubuntu/document/mongodb/log/rs1:/var/log/mongodb:rw
      - /home/ubuntu/document/mongodb/config:/var/lib/mongodb/config:ro
    command: --keyFile /app/auth.key --replSet rs0 --dbpath /var/lib/mongodb
    ports:
      - 27018:27017
    environment:
      MONGO_INITDB_ROOT_USERNAME: alomerry
      MONGO_INITDB_ROOT_PASSWORD: WjC120211
    logging:
      driver: json-file
      options:
        max-file: &#39;2&#39;
        max-size: 100m
  alomerry-mongodb-rs2:
    image: mongo-replset-4.2.17-bionic
    volumes:
      - /home/ubuntu/document/mongodb/db/rs2:/var/lib/mongodb:rw
      - /home/ubuntu/document/mongodb/log/rs1:/var/log/mongodb:rw
      - /home/ubuntu/document/mongodb/config:/var/lib/mongodb/config:ro
    command: --keyFile /app/auth.key --replSet rs0 --dbpath /var/lib/mongodb --auth
    ports:
      - 27019:27017
    environment:
      MONGO_INITDB_ROOT_USERNAME: alomerry
      MONGO_INITDB_ROOT_PASSWORD: WjC120211
    logging:
      driver: json-file
      options:
        max-file: &#39;2&#39;
        max-size: 100m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6DFB\u52A0" tabindex="-1"><a class="header-anchor" href="#\u6DFB\u52A0" aria-hidden="true">#</a> \u6DFB\u52A0</h3>`,133),r=[a];function s(d,l){return t(),o("div",null,r)}var c=e(n,[["render",s],["__file","2021-05-22-mongodb.html.vue"]]);export{c as default};
