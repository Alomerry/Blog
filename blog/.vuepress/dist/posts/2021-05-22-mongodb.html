<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" type="image/ico" sizes="16x16" href="/img/logo/favicon-16x16.ico"><link rel="icon" type="image/png" sizes="32x32" href="/img/logo/favicon-32x32.png"><meta name="application-name" content="Alomerry Wu"><meta name="apple-mobile-web-app-title" content="Alomerry Wu"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png"><meta name="theme-color" content="#377bb5"><meta name="msapplication-TileColor" content="#377bb5"><title>MongoDB Note | Alomerry Wu</title><meta name="description" content="Alomerry's blog, powered by VuePress 2, themed by Gungnir.">
    <link rel="modulepreload" href="/assets/app.a324704d.js"><link rel="modulepreload" href="/assets/2021-05-22-mongodb.html.a1724401.js"><link rel="modulepreload" href="/assets/2021-05-22-mongodb.html.a2933057.js"><link rel="prefetch" href="/assets/2019-07-02-reading-note.html.041b614b.js"><link rel="prefetch" href="/assets/2019-07-18-beian.html.0db5a56e.js"><link rel="prefetch" href="/assets/2019-08-02-useful-cpp-lib.html.3c35b767.js"><link rel="prefetch" href="/assets/2020-01-17-typecho-theme-plugs.html.64b1ee31.js"><link rel="prefetch" href="/assets/2020-01-18-gk64-unpack.html.270c0b23.js"><link rel="prefetch" href="/assets/2020-02-14-deploy-ssr-server.html.18de6f2a.js"><link rel="prefetch" href="/assets/2020-07-06-code-review-note.html.a7ce491c.js"><link rel="prefetch" href="/assets/2020-07-06-git-note.html.fc9a97a8.js"><link rel="prefetch" href="/assets/2020-07-06-html-note.html.0f07b66f.js"><link rel="prefetch" href="/assets/2020-07-06-redis-note.html.bcddad46.js"><link rel="prefetch" href="/assets/2020-08-10-golang-note.html.b23ed8a1.js"><link rel="prefetch" href="/assets/2020-10-03-clean-code.html.ad4db63b.js"><link rel="prefetch" href="/assets/2021-03-01-go-programming-language.html.c9e533fe.js"><link rel="prefetch" href="/assets/2021-03-14-note.html.24236172.js"><link rel="prefetch" href="/assets/2021-03-15-postman.html.a895298a.js"><link rel="prefetch" href="/assets/2021-06-23-grpc.html.e1dee8fb.js"><link rel="prefetch" href="/assets/2021-08-12-rocketmq.html.99bacd59.js"><link rel="prefetch" href="/assets/2022-02-14-csapp.html.6a27ec0d.js"><link rel="prefetch" href="/assets/2022-02-14-go-design.html.cd852358.js"><link rel="prefetch" href="/assets/2022-02-14-go-std-lib.html.344e2a92.js"><link rel="prefetch" href="/assets/2022-02-14-gopl.html.db50e95e.js"><link rel="prefetch" href="/assets/2022-02-26-nginx-note.html.5b83d830.js"><link rel="prefetch" href="/assets/2022-03-08-markdown-grammar.html.858ef36d.js"><link rel="prefetch" href="/assets/2022-03-15-system-io.html.9b8fa251.js"><link rel="prefetch" href="/assets/2022-04-26-install-rocket-chat.html.36f9ff38.js"><link rel="prefetch" href="/assets/2022-04-27-docker.html.2e5bdf66.js"><link rel="prefetch" href="/assets/2022-04-29-bot-huan.html.2bb76b9b.js"><link rel="prefetch" href="/assets/2022-04-29-gin-note.html.2e85a715.js"><link rel="prefetch" href="/assets/2022-05-21-obs.html.ecb180ff.js"><link rel="prefetch" href="/assets/2022-05-29-home-vm-ubuntu.html.a871f82c.js"><link rel="prefetch" href="/assets/2022-06-01-linux.html.a1306cd2.js"><link rel="prefetch" href="/assets/2022-06-17-frp.html.2c5d4b20.js"><link rel="prefetch" href="/assets/2022-06-19-v2ray-server.html.7f76d0ef.js"><link rel="prefetch" href="/assets/2022-06-23-jenkins.html.a3d76e8c.js"><link rel="prefetch" href="/assets/2022-06-23-todo.html.d345e540.js"><link rel="prefetch" href="/assets/index.html.b902b90a.js"><link rel="prefetch" href="/assets/404.html.7c518b82.js"><link rel="prefetch" href="/assets/index.html.28fa388e.js"><link rel="prefetch" href="/assets/index.html.271c9982.js"><link rel="prefetch" href="/assets/index.html.f805eeef.js"><link rel="prefetch" href="/assets/index.html.9ba466f4.js"><link rel="prefetch" href="/assets/index.html.aac6ab05.js"><link rel="prefetch" href="/assets/index.html.f94ad01b.js"><link rel="prefetch" href="/assets/index.html.563c905f.js"><link rel="prefetch" href="/assets/index.html.b148dd27.js"><link rel="prefetch" href="/assets/index.html.7e07a7d9.js"><link rel="prefetch" href="/assets/index.html.7573e57d.js"><link rel="prefetch" href="/assets/index.html.ae06e8f1.js"><link rel="prefetch" href="/assets/index.html.4ca35717.js"><link rel="prefetch" href="/assets/index.html.516bd552.js"><link rel="prefetch" href="/assets/index.html.7fab4987.js"><link rel="prefetch" href="/assets/index.html.254493f6.js"><link rel="prefetch" href="/assets/index.html.191f38a0.js"><link rel="prefetch" href="/assets/index.html.0afbcb0b.js"><link rel="prefetch" href="/assets/index.html.fd51d1c1.js"><link rel="prefetch" href="/assets/index.html.20693e11.js"><link rel="prefetch" href="/assets/index.html.c569bd01.js"><link rel="prefetch" href="/assets/index.html.cc437d49.js"><link rel="prefetch" href="/assets/index.html.7e9de704.js"><link rel="prefetch" href="/assets/index.html.a8b10ff8.js"><link rel="prefetch" href="/assets/index.html.6036cc19.js"><link rel="prefetch" href="/assets/index.html.d25919a3.js"><link rel="prefetch" href="/assets/index.html.d73e3a3d.js"><link rel="prefetch" href="/assets/index.html.9b6c5164.js"><link rel="prefetch" href="/assets/index.html.28d950e2.js"><link rel="prefetch" href="/assets/index.html.e07d945d.js"><link rel="prefetch" href="/assets/index.html.b21d3d43.js"><link rel="prefetch" href="/assets/index.html.0d29bc77.js"><link rel="prefetch" href="/assets/2019-07-02-reading-note.html.deb9bb84.js"><link rel="prefetch" href="/assets/2019-07-18-beian.html.4a266d11.js"><link rel="prefetch" href="/assets/2019-08-02-useful-cpp-lib.html.54058ced.js"><link rel="prefetch" href="/assets/2020-01-17-typecho-theme-plugs.html.22b5d03c.js"><link rel="prefetch" href="/assets/2020-01-18-gk64-unpack.html.b53bbc6a.js"><link rel="prefetch" href="/assets/2020-02-14-deploy-ssr-server.html.f8876dbe.js"><link rel="prefetch" href="/assets/2020-07-06-code-review-note.html.141ab440.js"><link rel="prefetch" href="/assets/2020-07-06-git-note.html.95cc3d95.js"><link rel="prefetch" href="/assets/2020-07-06-html-note.html.d513d807.js"><link rel="prefetch" href="/assets/2020-07-06-redis-note.html.368665ca.js"><link rel="prefetch" href="/assets/2020-08-10-golang-note.html.eb260974.js"><link rel="prefetch" href="/assets/2020-10-03-clean-code.html.6be19803.js"><link rel="prefetch" href="/assets/2021-03-01-go-programming-language.html.78f3a198.js"><link rel="prefetch" href="/assets/2021-03-14-note.html.fb49e7de.js"><link rel="prefetch" href="/assets/2021-03-15-postman.html.fc771871.js"><link rel="prefetch" href="/assets/2021-06-23-grpc.html.4913add0.js"><link rel="prefetch" href="/assets/2021-08-12-rocketmq.html.488db9fe.js"><link rel="prefetch" href="/assets/2022-02-14-csapp.html.a1be3d6a.js"><link rel="prefetch" href="/assets/2022-02-14-go-design.html.e7ecde4b.js"><link rel="prefetch" href="/assets/2022-02-14-go-std-lib.html.dd9c87ea.js"><link rel="prefetch" href="/assets/2022-02-14-gopl.html.b034d696.js"><link rel="prefetch" href="/assets/2022-02-26-nginx-note.html.960450b2.js"><link rel="prefetch" href="/assets/2022-03-08-markdown-grammar.html.9b57589f.js"><link rel="prefetch" href="/assets/2022-03-15-system-io.html.c11f1526.js"><link rel="prefetch" href="/assets/2022-04-26-install-rocket-chat.html.7b0b7a56.js"><link rel="prefetch" href="/assets/2022-04-27-docker.html.46bb1452.js"><link rel="prefetch" href="/assets/2022-04-29-bot-huan.html.cbe98c23.js"><link rel="prefetch" href="/assets/2022-04-29-gin-note.html.2e34f4fb.js"><link rel="prefetch" href="/assets/2022-05-21-obs.html.82bc1945.js"><link rel="prefetch" href="/assets/2022-05-29-home-vm-ubuntu.html.28941440.js"><link rel="prefetch" href="/assets/2022-06-01-linux.html.82b8ca79.js"><link rel="prefetch" href="/assets/2022-06-17-frp.html.cb24a12e.js"><link rel="prefetch" href="/assets/2022-06-19-v2ray-server.html.acaaa97f.js"><link rel="prefetch" href="/assets/2022-06-23-jenkins.html.e68b795e.js"><link rel="prefetch" href="/assets/2022-06-23-todo.html.d8bf8021.js"><link rel="prefetch" href="/assets/index.html.c525a9b7.js"><link rel="prefetch" href="/assets/404.html.5a53fc5d.js"><link rel="prefetch" href="/assets/index.html.77f0ca6b.js"><link rel="prefetch" href="/assets/index.html.cc99a0ae.js"><link rel="prefetch" href="/assets/index.html.23cc2fe8.js"><link rel="prefetch" href="/assets/index.html.6294dee5.js"><link rel="prefetch" href="/assets/index.html.08263dde.js"><link rel="prefetch" href="/assets/index.html.466afc3c.js"><link rel="prefetch" href="/assets/index.html.c2a071d2.js"><link rel="prefetch" href="/assets/index.html.a67639c2.js"><link rel="prefetch" href="/assets/index.html.79d963c8.js"><link rel="prefetch" href="/assets/index.html.25e5bcd9.js"><link rel="prefetch" href="/assets/index.html.01ffea2c.js"><link rel="prefetch" href="/assets/index.html.bcb848a8.js"><link rel="prefetch" href="/assets/index.html.82c4a9d6.js"><link rel="prefetch" href="/assets/index.html.573e9c07.js"><link rel="prefetch" href="/assets/index.html.c99368fb.js"><link rel="prefetch" href="/assets/index.html.774053a8.js"><link rel="prefetch" href="/assets/index.html.20f61b10.js"><link rel="prefetch" href="/assets/index.html.4933ffdb.js"><link rel="prefetch" href="/assets/index.html.8162b8be.js"><link rel="prefetch" href="/assets/index.html.660aa432.js"><link rel="prefetch" href="/assets/index.html.3daf178e.js"><link rel="prefetch" href="/assets/index.html.6dc5a891.js"><link rel="prefetch" href="/assets/index.html.497da68c.js"><link rel="prefetch" href="/assets/index.html.cd041081.js"><link rel="prefetch" href="/assets/index.html.1a5a9ccc.js"><link rel="prefetch" href="/assets/index.html.b298f26c.js"><link rel="prefetch" href="/assets/index.html.31b621d8.js"><link rel="prefetch" href="/assets/index.html.aa4c042c.js"><link rel="prefetch" href="/assets/index.html.68dc9428.js"><link rel="prefetch" href="/assets/index.html.6d052016.js"><link rel="prefetch" href="/assets/index.html.2e37f82e.js"><link rel="prefetch" href="/assets/404.aecbbb3a.js"><link rel="prefetch" href="/assets/HomePage.2d6ee5eb.js"><link rel="prefetch" href="/assets/Layout.9a27aace.js"><link rel="prefetch" href="/assets/Links.2c588e6f.js"><link rel="prefetch" href="/assets/Post.25cc428c.js"><link rel="prefetch" href="/assets/Tags.05c9e79f.js"><link rel="prefetch" href="/assets/mermaid.esm.min.bb1c7ac8.js">
    <link rel="stylesheet" href="/assets/style.03f84e94.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar invert"><span><a href="/" class=""><span class="site-name">$ cd /home/</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="Home"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M489.2 287.9h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6V146.2c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6v-32c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6v-32c0-6-8-4.6-11.7-4.6v-38c8.3-2 17.1-3.4 25.7-3.4 10.9 0 20.9 4.3 31.4 4.3 4.6 0 27.7-1.1 27.7-8v-60c0-2.6-2-4.6-4.6-4.6-5.1 0-15.1 4.3-24 4.3-9.7 0-20.9-4.3-32.6-4.3-8 0-16 1.1-23.7 2.9v-4.9c5.4-2.6 9.1-8.3 9.1-14.3 0-20.7-31.4-20.8-31.4 0 0 6 3.7 11.7 9.1 14.3v111.7c-3.7 0-11.7-1.4-11.7 4.6v32h-36.6v-32c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32H128v-32c0-2.6-2-4.6-4.6-4.6H96c-2.6 0-4.6 2-4.6 4.6v178.3H54.8v-32c0-2.6-2-4.6-4.6-4.6H22.8c-2.6 0-4.6 2-4.6 4.6V512h182.9v-96c0-72.6 109.7-72.6 109.7 0v96h182.9V292.5c.1-2.6-1.9-4.6-4.5-4.6zm-288.1-4.5c0 2.6-2 4.6-4.6 4.6h-27.4c-2.6 0-4.6-2-4.6-4.6v-64c0-2.6 2-4.6 4.6-4.6h27.4c2.6 0 4.6 2 4.6 4.6v64zm146.4 0c0 2.6-2 4.6-4.6 4.6h-27.4c-2.6 0-4.6-2-4.6-4.6v-64c0-2.6 2-4.6 4.6-4.6h27.4c2.6 0 4.6 2 4.6 4.6v64z"/></svg></span><span>Home</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/about/" class="" aria-label="About"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M256 224c-79.41 0-192 122.76-192 200.25 0 34.9 26.81 55.75 71.74 55.75 48.84 0 81.09-25.08 120.26-25.08 39.51 0 71.85 25.08 120.26 25.08 44.93 0 71.74-20.85 71.74-55.75C448 346.76 335.41 224 256 224zm-147.28-12.61c-10.4-34.65-42.44-57.09-71.56-50.13-29.12 6.96-44.29 40.69-33.89 75.34 10.4 34.65 42.44 57.09 71.56 50.13 29.12-6.96 44.29-40.69 33.89-75.34zm84.72-20.78c30.94-8.14 46.42-49.94 34.58-93.36s-46.52-72.01-77.46-63.87-46.42 49.94-34.58 93.36c11.84 43.42 46.53 72.02 77.46 63.87zm281.39-29.34c-29.12-6.96-61.15 15.48-71.56 50.13-10.4 34.65 4.77 68.38 33.89 75.34 29.12 6.96 61.15-15.48 71.56-50.13 10.4-34.65-4.77-68.38-33.89-75.34zm-156.27 29.34c30.94 8.14 65.62-20.45 77.46-63.87 11.84-43.42-3.64-85.21-34.58-93.36s-65.62 20.45-77.46 63.87c-11.84 43.42 3.64 85.22 34.58 93.36z"/></svg></span><span>About</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/tags/" class="" aria-label="Tags"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg></span><span>Tags</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/links/" class="" aria-label="Links"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M305.45 462.59c7.391 7.298 6.188 20.097-3 25.004-77.714 41.802-176.726 29.91-242.344-35.709-65.602-65.603-77.51-164.523-35.692-242.331 4.891-9.095 17.69-10.298 25.003-3l116.812 116.813 27.394-27.394c-.688-2.61-1.594-5.001-1.594-7.814a32.004 32.004 0 1132.004 32.005c-2.797 0-5.204-.891-7.798-1.594l-27.41 27.41zm206.526-159.523a16.103 16.103 0 01-16.002 17.003H463.86a15.97 15.97 0 01-15.892-15.002C440.467 175.549 336.453 70.534 207.03 63.533a15.845 15.845 0 01-15.002-15.908V16.027A16.094 16.094 0 01209.03.024C372.255 8.62 503.475 139.841 511.976 303.067zm-96.012-.297a16.21 16.21 0 01-16.112 17.3h-32.207a16.069 16.069 0 01-15.893-14.705c-6.907-77.011-68.118-138.91-144.924-145.224a15.94 15.94 0 01-14.8-15.893v-32.114a16.134 16.134 0 0117.3-16.096c110.123 8.501 198.228 96.607 206.636 206.732z"/></svg></span><span>Links</span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://io.alomerry.com" rel="noopener noreferrer" target="_blank" aria-label="IOI"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path d="M9.05.435c-.58-.58-1.52-.58-2.1 0L.436 6.95c-.58.58-.58 1.519 0 2.098l6.516 6.516c.58.58 1.519.58 2.098 0l6.516-6.516c.58-.58.58-1.519 0-2.098L9.05.435zM8 .989c.127 0 .253.049.35.145l6.516 6.516a.495.495 0 010 .7L8.35 14.866a.493.493 0 01-.35.145V.989z"/></svg></span><span>IOI</span><!--[--><!--]--></a></div><!--]--><div class="navbar-item"><a style="cursor:pointer;"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg></span><span>Search</span></a></div></nav><!--[--><!--]--><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="Home"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M489.2 287.9h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6V146.2c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6v-32c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6v-32c0-6-8-4.6-11.7-4.6v-38c8.3-2 17.1-3.4 25.7-3.4 10.9 0 20.9 4.3 31.4 4.3 4.6 0 27.7-1.1 27.7-8v-60c0-2.6-2-4.6-4.6-4.6-5.1 0-15.1 4.3-24 4.3-9.7 0-20.9-4.3-32.6-4.3-8 0-16 1.1-23.7 2.9v-4.9c5.4-2.6 9.1-8.3 9.1-14.3 0-20.7-31.4-20.8-31.4 0 0 6 3.7 11.7 9.1 14.3v111.7c-3.7 0-11.7-1.4-11.7 4.6v32h-36.6v-32c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32H128v-32c0-2.6-2-4.6-4.6-4.6H96c-2.6 0-4.6 2-4.6 4.6v178.3H54.8v-32c0-2.6-2-4.6-4.6-4.6H22.8c-2.6 0-4.6 2-4.6 4.6V512h182.9v-96c0-72.6 109.7-72.6 109.7 0v96h182.9V292.5c.1-2.6-1.9-4.6-4.5-4.6zm-288.1-4.5c0 2.6-2 4.6-4.6 4.6h-27.4c-2.6 0-4.6-2-4.6-4.6v-64c0-2.6 2-4.6 4.6-4.6h27.4c2.6 0 4.6 2 4.6 4.6v64zm146.4 0c0 2.6-2 4.6-4.6 4.6h-27.4c-2.6 0-4.6-2-4.6-4.6v-64c0-2.6 2-4.6 4.6-4.6h27.4c2.6 0 4.6 2 4.6 4.6v64z"/></svg></span><span>Home</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/about/" class="" aria-label="About"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M256 224c-79.41 0-192 122.76-192 200.25 0 34.9 26.81 55.75 71.74 55.75 48.84 0 81.09-25.08 120.26-25.08 39.51 0 71.85 25.08 120.26 25.08 44.93 0 71.74-20.85 71.74-55.75C448 346.76 335.41 224 256 224zm-147.28-12.61c-10.4-34.65-42.44-57.09-71.56-50.13-29.12 6.96-44.29 40.69-33.89 75.34 10.4 34.65 42.44 57.09 71.56 50.13 29.12-6.96 44.29-40.69 33.89-75.34zm84.72-20.78c30.94-8.14 46.42-49.94 34.58-93.36s-46.52-72.01-77.46-63.87-46.42 49.94-34.58 93.36c11.84 43.42 46.53 72.02 77.46 63.87zm281.39-29.34c-29.12-6.96-61.15 15.48-71.56 50.13-10.4 34.65 4.77 68.38 33.89 75.34 29.12 6.96 61.15-15.48 71.56-50.13 10.4-34.65-4.77-68.38-33.89-75.34zm-156.27 29.34c30.94 8.14 65.62-20.45 77.46-63.87 11.84-43.42-3.64-85.21-34.58-93.36s-65.62 20.45-77.46 63.87c-11.84 43.42 3.64 85.22 34.58 93.36z"/></svg></span><span>About</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/tags/" class="" aria-label="Tags"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg></span><span>Tags</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/links/" class="" aria-label="Links"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M305.45 462.59c7.391 7.298 6.188 20.097-3 25.004-77.714 41.802-176.726 29.91-242.344-35.709-65.602-65.603-77.51-164.523-35.692-242.331 4.891-9.095 17.69-10.298 25.003-3l116.812 116.813 27.394-27.394c-.688-2.61-1.594-5.001-1.594-7.814a32.004 32.004 0 1132.004 32.005c-2.797 0-5.204-.891-7.798-1.594l-27.41 27.41zm206.526-159.523a16.103 16.103 0 01-16.002 17.003H463.86a15.97 15.97 0 01-15.892-15.002C440.467 175.549 336.453 70.534 207.03 63.533a15.845 15.845 0 01-15.002-15.908V16.027A16.094 16.094 0 01209.03.024C372.255 8.62 503.475 139.841 511.976 303.067zm-96.012-.297a16.21 16.21 0 01-16.112 17.3h-32.207a16.069 16.069 0 01-15.893-14.705c-6.907-77.011-68.118-138.91-144.924-145.224a15.94 15.94 0 01-14.8-15.893v-32.114a16.134 16.134 0 0117.3-16.096c110.123 8.501 198.228 96.607 206.636 206.732z"/></svg></span><span>Links</span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://io.alomerry.com" rel="noopener noreferrer" target="_blank" aria-label="IOI"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path d="M9.05.435c-.58-.58-1.52-.58-2.1 0L.436 6.95c-.58.58-.58 1.519 0 2.098l6.516 6.516c.58.58 1.519.58 2.098 0l6.516-6.516c.58-.58.58-1.519 0-2.098L9.05.435zM8 .989c.127 0 .253.049.35.145l6.516 6.516a.495.495 0 010 .7L8.35 14.866a.493.493 0 01-.35.145V.989z"/></svg></span><span>IOI</span><!--[--><!--]--></a></div><!--]--><div class="navbar-item"><a style="cursor:pointer;"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg></span><span>Search</span></a></div></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><div class="page-content"><!--[--><div class="show-catalog post-wrapper"><div class="article-header use-image post-header" style="background-image:url(https://cdn.alomerry.com/blog/img/in-post/header-image/8.jpg);"><div class="article-header-mask" style="background:rgba(40, 57, 101, .5);"></div><div class="article-header-content"><div class="article-tags"><!--[--><span class="article-tag">Y2021</span><span class="article-tag">U2022</span><span class="article-tag">MongoDB</span><!--]--></div><h1 class="article-title">MongoDB Note</h1><!----><div class="article-icons"><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z"/></svg><span>Alomerry Wu</span></div><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M400 64h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zm-6 400H54c-3.3 0-6-2.7-6-6V160h352v298c0 3.3-2.7 6-6 6z"/></svg><span>2021-05-22</span></div><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M17.618 5.968l1.453-1.453 1.414 1.414-1.453 1.453a9 9 0 11-1.414-1.414zM12 20a7 7 0 100-14 7 7 0 000 14zM11 8h2v6h-2V8zM8 1h8v2H8V1z"/></svg><span>22 min</span></div></div></div><!----></div><main class="page post-content"><!--[--><!--]--><div class="theme-gungnir-content"><!--[--><!--]--><div><h2 id="transacation-4-2" tabindex="-1"><a class="header-anchor" href="#transacation-4-2" aria-hidden="true">#</a> Transacation 4.2</h2><ul><li>暂时无法在事务中创建集合</li><li>事务中不能使用不同 client</li></ul><h2 id="install-mongodb-4-2" tabindex="-1"><a class="header-anchor" href="#install-mongodb-4-2" aria-hidden="true">#</a> <a href="https://docs.mongodb.com/v4.2/tutorial/install-mongodb-on-ubuntu/" target="_blank" rel="noopener noreferrer">Install mongodb 4.2</a></h2><h3 id="ubuntu-18-04" tabindex="-1"><a class="header-anchor" href="#ubuntu-18-04" aria-hidden="true">#</a> Ubuntu 18.04</h3><h4 id="卸载" tabindex="-1"><a class="header-anchor" href="#卸载" aria-hidden="true">#</a> 卸载</h4><p><code>sudo apt-get purge mongodb-org*</code></p><h4 id="停止" tabindex="-1"><a class="header-anchor" href="#停止" aria-hidden="true">#</a> 停止</h4><p><code>sudo service mongod stop</code></p><h4 id="删除数据" tabindex="-1"><a class="header-anchor" href="#删除数据" aria-hidden="true">#</a> 删除数据</h4><p><code>sudo rm -r /var/log/mongodb</code><code>sudo rm -r /var/lib/mongodb</code></p><h4 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h4><h5 id="import-the-public-key-used-by-the-package-management-system" tabindex="-1"><a class="header-anchor" href="#import-the-public-key-used-by-the-package-management-system" aria-hidden="true">#</a> Import the public key used by the package management system</h5><ul><li>添加 MongoDB public GPG：</li></ul><p><code>wget -qO - https://www.mongodb.org/static/pgp/server-4.4.asc | sudo apt-key add -</code></p><ul><li>安装 gnupg 及其依赖库</li></ul><p><code>sudo apt-get install gnupg</code></p><ul><li>安装后重新导入密钥</li></ul><p><code>wget -qO - https://www.mongodb.org/static/pgp/server-4.4.asc | sudo apt-key add -</code></p><h5 id="create-a-list-file-for-mongodb" tabindex="-1"><a class="header-anchor" href="#create-a-list-file-for-mongodb" aria-hidden="true">#</a> Create a list file for MongoDB</h5><ul><li>Create the <code>/etc/apt/sources.list.d/mongodb-org-4.2.list</code> file for Ubuntu 18.04 (Bionic):</li></ul><p><code>echo &quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-4.2.list</code></p><ul><li>Reload local package database.</li></ul><p><code>sudo apt-get update</code></p><ul><li>Install the MongoDB packages.</li></ul><p><code>sudo apt-get install -y mongodb-org=4.4.1 mongodb-org-server=4.4.1 mongodb-org-shell=4.4.1 mongodb-org-mongos=4.4.1 mongodb-org-tools=4.4.1</code></p><h4 id="启动" tabindex="-1"><a class="header-anchor" href="#启动" aria-hidden="true">#</a> 启动</h4><p><code>sudo service mongod start</code></p><h4 id="查看状态" tabindex="-1"><a class="header-anchor" href="#查看状态" aria-hidden="true">#</a> 查看状态</h4><p><code>sudo service mongod status</code></p><h5 id="创建账号" tabindex="-1"><a class="header-anchor" href="#创建账号" aria-hidden="true">#</a> 创建账号</h5><p><code>db.createUser({user:&quot;admin&quot;, pwd:&quot;admin111&quot;, roles:[{role:&quot;root&quot;, db:&quot;admin&quot;}]})</code></p><h5 id="远程连接" tabindex="-1"><a class="header-anchor" href="#远程连接" aria-hidden="true">#</a> 远程连接</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/mongod.conf

net:
  port: <span class="token number">27017</span>  <span class="token comment"># 端口</span>
  bindIp: <span class="token number">0.0</span>.0.0  <span class="token comment"># 允许访问的地址，0.0.0.0表示所有</span>

security:
  authorization: enabled
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="export-and-import" tabindex="-1"><a class="header-anchor" href="#export-and-import" aria-hidden="true">#</a> export And import</h2><p>https://docs.mongodb.com/v4.2/reference/program/mongoimport/ https://www.mongodb.org.cn/manual/197.html <code>/exportMongodbData --collection=&lt;collectionName&gt; --pretty --query=&#39;{ &quot;\_id&quot; : {&quot;$oid&quot;:&quot;xxxx&quot;}, &quot;isDeleted&quot;: false ,&quot;createdAt&quot; : {&quot;$gt&quot;:{&quot;$date&quot;:&quot;2021-01-01T01:09:28.810Z&quot;}}}&#39; --type=json &lt;dbName&gt;</code></p><h2 id="go-mongodb-driver-2020-09-30" tabindex="-1"><a class="header-anchor" href="#go-mongodb-driver-2020-09-30" aria-hidden="true">#</a> go-mongodb-driver (2020/09/30)</h2><h3 id="clientoptions" tabindex="-1"><a class="header-anchor" href="#clientoptions" aria-hidden="true">#</a> ClientOptions</h3><h4 id="appname" tabindex="-1"><a class="header-anchor" href="#appname" aria-hidden="true">#</a> AppName</h4><blockquote><p>AppName specifies an application name that is sent to the server when creating new connections. It is used by the server to log connection and profiling information (e.g. slow query logs). This can also be set through the &quot;appName&quot; URI option (e.g appName=example_application&quot;). The default is empty, meaning no app name will be sent.</p></blockquote><h4 id="auth" tabindex="-1"><a class="header-anchor" href="#auth" aria-hidden="true">#</a> Auth</h4><blockquote><p>Auth specifies a Credential containing options for configuring authentication. See the options.Credential documentation for more information about Credential fields. The default is an empty Credential, meaning no authentication will be configured.</p></blockquote><h4 id="compressors" tabindex="-1"><a class="header-anchor" href="#compressors" aria-hidden="true">#</a> Compressors</h4><blockquote><p>Compressors sets the compressors that can be used when communicating with a server. Valid values are:</p><ol><li>&quot;snappy&quot; - requires server version &gt;= 3.4</li><li>&quot;zlib&quot; - requires server version &gt;= 3.6</li><li>&quot;zstd&quot; - requires server version &gt;= 4.2, and driver version &gt;= 1.2.0 with cgo support enabled or driver version &gt;= 1.3.0 without cgo</li></ol><p>If this option is specified, the driver will perform a negotiation with the server to determine a common list of of compressors and will use the first one in that list when performing operations. See https://docs.mongodb.com/manual/reference/program/mongod/#cmdoption-mongod-networkmessagecompressors for more information about configuring compression on the server and the server-side defaults. This can also be set through the &quot; compressors&quot; URI option (e.g. &quot;compressors=zstd,zlib,snappy&quot;). The default is an empty slice, meaning no compression will be enabled.</p></blockquote><h4 id="connecttimeout" tabindex="-1"><a class="header-anchor" href="#connecttimeout" aria-hidden="true">#</a> ConnectTimeout</h4><blockquote><p>ConnectTimeout specifies a timeout that is used for creating connections to the server. If a custom Dialer is specified through SetDialer, this option must not be used. This can be set through ApplyURI with the &quot; connectTimeoutMS&quot; (e.g &quot;connectTimeoutMS=30&quot;) option. If set to 0, no timeout will be used. The default is 30 seconds.</p></blockquote><h4 id="dialer" tabindex="-1"><a class="header-anchor" href="#dialer" aria-hidden="true">#</a> Dialer</h4><blockquote><p>Dialer specifies a custom ContextDialer to be used to create new connections to the server. The default is a net.Dialer with the Timeout field set to ConnectTimeout. See https://golang.org/pkg/net/#Dialer for more information about the net.Dialer type.</p></blockquote><h4 id="direct" tabindex="-1"><a class="header-anchor" href="#direct" aria-hidden="true">#</a> Direct</h4><blockquote><p>Direct specifies whether or not a direct connect should be made. If set to true, the driver will only connect to the host provided in the URI and will not discover other hosts in the cluster. This can also be set through the &quot; directConnection&quot; URI option. This option cannot be set to true if multiple hosts are specified, either through ApplyURI or SetHosts, or an SRV URI is used. As of driver version 1.4, the &quot;connect&quot; URI option has been deprecated and replaced with &quot;directConnection&quot;. The &quot; connect&quot; URI option has two values:</p><ol><li>&quot;connect=direct&quot; for direct connections. This corresponds to &quot;directConnection=true&quot;.</li><li>&quot;connect=automatic&quot; for automatic discovery. This corresponds to &quot;directConnection=false&quot;</li></ol><p>If the &quot;connect&quot; and &quot;directConnection&quot; URI options are both specified in the connection string, their values must not conflict. Direct connections are not valid if multiple hosts are specified or an SRV URI is used. The default value for this option is false.</p></blockquote><h4 id="heartbeatinterval" tabindex="-1"><a class="header-anchor" href="#heartbeatinterval" aria-hidden="true">#</a> HeartbeatInterval</h4><blockquote><p>HeartbeatInterval specifies the amount of time to wait between periodic background server checks. This can also be set through the &quot;heartbeatIntervalMS&quot; URI option (e.g. &quot;heartbeatIntervalMS=10000&quot;). The default is 10 seconds.</p></blockquote><h4 id="hosts" tabindex="-1"><a class="header-anchor" href="#hosts" aria-hidden="true">#</a> Hosts</h4><blockquote><p>Hosts specifies a list of host names or IP addresses for servers in a cluster. Both IPv4 and IPv6 addresses are supported. IPv6 literals must be enclosed in &#39;[]&#39; following RFC-2732 syntax. Hosts can also be specified as a comma-separated list in a URI. For example, to include &quot;localhost:27017&quot; and &quot; localhost:27018&quot;, a URI could be &quot;mongodb://localhost:27017,localhost:27018&quot;. The default is [&quot;localhost:27017&quot;]</p></blockquote><h4 id="localthreshold" tabindex="-1"><a class="header-anchor" href="#localthreshold" aria-hidden="true">#</a> LocalThreshold</h4><blockquote><p>LocalThreshold specifies the width of the &#39;latency window&#39;: when choosing between multiple suitable servers for an operation, this is the acceptable non-negative delta between shortest and longest average round-trip times. A server within the latency window is selected randomly. This can also be set through the &quot;localThresholdMS&quot; URI option (e.g. &quot; localThresholdMS=15000&quot;). The default is 15 milliseconds.</p></blockquote><h4 id="maxconnidletime" tabindex="-1"><a class="header-anchor" href="#maxconnidletime" aria-hidden="true">#</a> MaxConnIdleTime</h4><blockquote><p>MaxConnIdleTime specifies the maximum amount of time that a connection will remain idle in a connection pool before it is removed from the pool and closed. This can also be set through the &quot;maxIdleTimeMS&quot; URI option (e.g. &quot; maxIdleTimeMS=10000&quot;). The default is 0, meaning a connection can remain unused indefinitely.</p></blockquote><h4 id="maxpoolsize" tabindex="-1"><a class="header-anchor" href="#maxpoolsize" aria-hidden="true">#</a> MaxPoolSize</h4><blockquote><p>MaxPoolSize specifies that maximum number of connections allowed in the driver&#39;s connection pool to each server.Requests to a server will block if this maximum is reached. This can also be set through the &quot;maxPoolSize&quot; URI option (e.g. &quot;maxPoolSize=100&quot;). The default is 100. If this is 0, it will be set to math.MaxInt64.</p></blockquote><h4 id="minpoolsize" tabindex="-1"><a class="header-anchor" href="#minpoolsize" aria-hidden="true">#</a> MinPoolSize</h4><blockquote><p>MinPoolSize specifies the minimum number of connections allowed in the driver&#39;s connection pool to each server. If this is non-zero, each server&#39;s pool will be maintained in the background to ensure that the size does not fall below the minimum. This can also be set through the &quot;minPoolSize&quot; URI option (e.g. &quot;minPoolSize=100&quot;).</p></blockquote><h4 id="poolmonitor" tabindex="-1"><a class="header-anchor" href="#poolmonitor" aria-hidden="true">#</a> PoolMonitor</h4><blockquote><p>PoolMonitor specifies a PoolMonitor to receive connection pool events. See the event.PoolMonitor documentation for more information about the structure of the monitor and events that can be received.</p></blockquote><h4 id="monitor" tabindex="-1"><a class="header-anchor" href="#monitor" aria-hidden="true">#</a> Monitor</h4><blockquote><p>Monitor specifies a CommandMonitor to receive command events. See the event.CommandMonitor documentation for more information about the structure of the monitor and events that can be received.</p></blockquote><h4 id="readconcern" tabindex="-1"><a class="header-anchor" href="#readconcern" aria-hidden="true">#</a> ReadConcern</h4><blockquote><p>ReadConcern specifies the read concern to use for read operations. A read concern level can also be set through the &quot; readConcernLevel&quot; URI option (e.g. &quot;readConcernLevel=majority&quot;). The default is nil, meaning the server will use its configured default.</p></blockquote><h4 id="readpreference" tabindex="-1"><a class="header-anchor" href="#readpreference" aria-hidden="true">#</a> ReadPreference</h4><blockquote><p>ReadPreference specifies the read preference to use for read operations. This can also be set through the following URI options:</p><ol><li>&quot;readPreference&quot; - Specifiy the read preference mode (e.g. &quot;readPreference=primary&quot;).</li><li>&quot;readPreferenceTags&quot;: Specify one or more read preference tags (e.g. &quot;readPreferenceTags=region:south,datacenter: A&quot;).</li><li>&quot;maxStalenessSeconds&quot; (or &quot;maxStaleness&quot;): Specify a maximum replication lag for reads from secondaries in a replica set (e.g. &quot;maxStalenessSeconds=10&quot;).</li></ol><p>The default is readpref.Primary(). See https://docs.mongodb.com/manual/core/read-preference/#read-preference for more information about read preferences.</p></blockquote><h4 id="registry" tabindex="-1"><a class="header-anchor" href="#registry" aria-hidden="true">#</a> Registry</h4><blockquote><p>Registry specifies the BSON registry to use for BSON marshalling/unmarshalling operations. The default is bson.DefaultRegistry.</p></blockquote><h4 id="replicaset" tabindex="-1"><a class="header-anchor" href="#replicaset" aria-hidden="true">#</a> ReplicaSet</h4><blockquote><p>ReplicaSet specifies the replica set name for the cluster. If specified, the cluster will be treated as a replica set and the driver will automatically discover all servers in the set, starting with the nodes specified through ApplyURI or SetHosts. All nodes in the replica set must have the same replica set name, or they will not be considered as part of the set by the Client. This can also be set through the &quot;replicaSet&quot; URI option (e.g. &quot;replicaSet=replset&quot;). The default is empty.</p></blockquote><h4 id="retrywrites" tabindex="-1"><a class="header-anchor" href="#retrywrites" aria-hidden="true">#</a> RetryWrites</h4><blockquote><p>RetryWrites specifies whether supported write operations should be retried once on certain errors, such as network errors. Supported operations are InsertOne, UpdateOne, ReplaceOne, DeleteOne, FindOneAndDelete, FindOneAndReplace, FindOneAndDelete, InsertMany, and BulkWrite. Note that BulkWrite requests must not include UpdateManyModel or DeleteManyModel instances to be considered retryable. Unacknowledged writes will not be retried, even if this option is set to true. This option requires server version &gt;= 3.6 and a replica set or sharded cluster and will be ignored for any other cluster type. This can also be set through the &quot;retryWrites&quot; URI option (e.g. &quot;retryWrites=true&quot;). The default is true.</p></blockquote><h4 id="retryreads" tabindex="-1"><a class="header-anchor" href="#retryreads" aria-hidden="true">#</a> RetryReads</h4><blockquote><p>RetryReads specifies whether supported read operations should be retried once on certain errors, such as network errors. Supported operations are Find, FindOne, Aggregate without a $out stage, Distinct, CountDocuments, EstimatedDocumentCount, Watch (for Client, Database, and Collection), ListCollections, and ListDatabases. Note that operations run through RunCommand are not retried. This option requires server version &gt;= 3.6 and driver version &gt;= 1.1.0. The default is true.</p></blockquote><h4 id="serverselectiontimeout" tabindex="-1"><a class="header-anchor" href="#serverselectiontimeout" aria-hidden="true">#</a> ServerSelectionTimeout</h4><blockquote><p>ServerSelectionTimeout specifies how long the driver will wait to find an available, suitable server to execute an operation. This can also be set through the &quot;serverSelectionTimeoutMS&quot; URI option (e.g. &quot; serverSelectionTimeoutMS=30000&quot;). The default value is 30 seconds.</p></blockquote><h4 id="sockettimeout" tabindex="-1"><a class="header-anchor" href="#sockettimeout" aria-hidden="true">#</a> SocketTimeout</h4><blockquote><p>SocketTimeout specifies how long the driver will wait for a socket read or write to return before returning a network error. This can also be set through the &quot;socketTimeoutMS&quot; URI option (e.g. &quot;socketTimeoutMS=1000&quot;). The default value is 0, meaning no timeout is used and socket operations can block indefinitely.</p></blockquote><h4 id="tlsconfig" tabindex="-1"><a class="header-anchor" href="#tlsconfig" aria-hidden="true">#</a> TLSConfig</h4><blockquote><p>TLSConfig specifies a tls.Config instance to use use to configure TLS on all connections created to the cluster. This can also be set through the following URI options:</p><ol><li>&quot;tls&quot; (or &quot;ssl&quot;): Specify if TLS should be used (e.g. &quot;tls=true&quot;).</li><li>Either &quot;tlsCertificateKeyFile&quot; (or &quot;sslClientCertificateKeyFile&quot;) or a combination of &quot;tlsCertificateFile&quot; and &quot; tlsPrivateKeyFile&quot;. The &quot;tlsCertificateKeyFile&quot; option specifies a path to the client certificate and private key, which must be concatenated into one file. The &quot;tlsCertificateFile&quot; and &quot;tlsPrivateKey&quot; combination specifies separate paths to the client certificate and private key, respectively. Note that if &quot;tlsCertificateKeyFile&quot; is used, the other two options must not be specified.</li><li>&quot;tlsCertificateKeyFilePassword&quot; (or &quot;sslClientCertificateKeyPassword&quot;): Specify the password to decrypt the client private key file (e.g. &quot;tlsCertificateKeyFilePassword=password&quot;).</li><li>&quot;tlsCaFile&quot; (or &quot;sslCertificateAuthorityFile&quot;): Specify the path to a single or bundle of certificate authorities to be considered trusted when making a TLS connection (e.g. &quot;tlsCaFile=/path/to/caFile&quot;).</li><li>&quot;tlsInsecure&quot; (or &quot;sslInsecure&quot;): Specifies whether or not certificates and hostnames received from the server should be validated. If true (e.g. &quot;tlsInsecure=true&quot;), the TLS library will accept any certificate presented by the server and any host name in that certificate. Note that setting this to true makes TLS susceptible to man-in-the-middle attacks and should only be done for testing. The default is nil, meaning no TLS will be enabled.</li></ol></blockquote><h4 id="writeconcern" tabindex="-1"><a class="header-anchor" href="#writeconcern" aria-hidden="true">#</a> WriteConcern</h4><blockquote><p>WriteConcern specifies the write concern to use to for write operations. This can also be set through the following URI options:</p><ol><li>&quot;w&quot;: Specify the number of nodes in the cluster that must acknowledge write operations before the operation returns or &quot;majority&quot; to specify that a majority of the nodes must acknowledge writes. This can either be an integer ( e.g. &quot;w=10&quot;) or the string &quot;majority&quot; (e.g. &quot;w=majority&quot;).</li><li>&quot;wTimeoutMS&quot;: Specify how long write operations should wait for the correct number of nodes to acknowledge the operation (e.g. &quot;wTimeoutMS=1000&quot;).</li><li>&quot;journal&quot;: Specifies whether or not write operations should be written to an on-disk journal on the server before returning (e.g. &quot;journal=true&quot;). The default is nil, meaning the server will use its configured default.</li></ol></blockquote><h4 id="zliblevel" tabindex="-1"><a class="header-anchor" href="#zliblevel" aria-hidden="true">#</a> ZlibLevel</h4><blockquote><p>specifies the level for the zlib compressor. This option is ignored if zlib is not specified as a compressor through ApplyURI or SetCompressors. Supported values are -1 through 9, inclusive. -1 tells the zlib library to use its default, 0 means no compression, 1 means best speed, and 9 means best compression. This can also be set through the &quot;zlibCompressionLevel&quot; URI option (e.g. &quot;zlibCompressionLevel=-1&quot;). Defaults to -1.</p></blockquote><h4 id="zstdlevel" tabindex="-1"><a class="header-anchor" href="#zstdlevel" aria-hidden="true">#</a> ZstdLevel</h4><blockquote><p>ZstdLevel sets the level for the zstd compressor. This option is ignored if zstd is not specified as a compressor through ApplyURI or SetCompressors. Supported values are 1 through 20, inclusive. 1 means best speed and 20 means best compression. This can also be set through the &quot;zstdCompressionLevel&quot; URI option. Defaults to 6.</p></blockquote><h4 id="autoencryptionoptions" tabindex="-1"><a class="header-anchor" href="#autoencryptionoptions" aria-hidden="true">#</a> AutoEncryptionOptions</h4><blockquote><p>AutoEncryptionOptions specifies an AutoEncryptionOptions instance to automatically encrypt and decrypt commands and their results. See the options.AutoEncryptionOptions documentation for more information about the supported options.</p></blockquote><h4 id="disableocspendpointcheck" tabindex="-1"><a class="header-anchor" href="#disableocspendpointcheck" aria-hidden="true">#</a> DisableOCSPEndpointCheck</h4><blockquote><p>DisableOCSPEndpointCheck specifies whether or not the driver should reach out to OCSP responders to verify the certificate status for certificates presented by the server that contain a list of OCSP responders. If set to true, the driver will verify the status of the certificate using a response stapled by the server, if there // is one, but will not send an HTTP request to any responders if there is no staple. In this case, the driver will continue the connection even though the certificate status is not known. This can also be set through the tlsDisableOCSPEndpointCheck URI option. Both this URI option and tlsInsecure must not be set at the same time and will error if they are. The default value is false.</p></blockquote><h2 id="常用命令" tabindex="-1"><a class="header-anchor" href="#常用命令" aria-hidden="true">#</a> 常用命令</h2><h3 id="ubuntu-使用-systemctl-命令强制密码验证登录" tabindex="-1"><a class="header-anchor" href="#ubuntu-使用-systemctl-命令强制密码验证登录" aria-hidden="true">#</a> Ubuntu 使用 Systemctl 命令强制密码验证登录</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /lib/systemd/system/mongod.service

systemctl daemon-reload
systemctl restart mongod
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="预定义角色" tabindex="-1"><a class="header-anchor" href="#预定义角色" aria-hidden="true">#</a> 预定义角色</h3><ul><li><p><strong>数据库用户角色（所有数据库都有）</strong></p><ul><li>read 用户可以读取当前数据库的数据</li><li>readWrite 用户可以读写当前数据库的数据</li></ul></li><li><p><strong>数据库管理角色（所有数据库都有）</strong></p><ul><li>dbAdmin 管理员用户但不能对用户和角色管理授权</li><li>dbOwner 数据库所有者可进行任何管理任务</li><li>userAdmin 可以管理当前数据的用户和角色</li></ul></li><li><p><strong>集群管理角色（admin 数据库可用）</strong></p><ul><li>clusterAdmin 集群所有管理权限，是 clusterManager、clusterMonitor、hostManager 合集</li><li>clusterManager 集群管理和监控</li><li>clusterMonitor 集群监控，只读的</li><li>hostManager 监控和管理服务器</li></ul></li><li><p><strong>备份和恢复角色（admin 数据库可用）</strong></p><ul><li>backup</li><li>restore</li></ul></li><li><p><strong>所有数据库角色（admin 数据库可用）</strong></p><ul><li>readAnyDatabase 读取所有数据库</li><li>readWriteAnyDatabase 读写所有数据库</li><li>userAdminAnyDatabase 所有数据库的 userAdmin 权限</li><li>dbAdminAnyDatabase 所有数据库的 dbAdmin 权限</li></ul></li><li><p><strong>超级角色（admin 数据库可用）</strong></p><ul><li>root 超级用户</li></ul></li><li><p><strong>内部角色</strong></p><ul><li>__system 所有操作权限</li></ul></li></ul><p>更多预定义角色信息见文档 <a href="https://docs.mongodb.com/manual/core/security-built-in-roles/" target="_blank" rel="noopener noreferrer">https://docs.mongodb.com/manual/core/security-built-in-roles/</a></p><h2 id="索引" tabindex="-1"><a class="header-anchor" href="#索引" aria-hidden="true">#</a> 索引</h2><p><a href="https://blog.csdn.net/weixin_33446857/article/details/83085018" target="_blank" rel="noopener noreferrer">索引</a></p><p>https://www.cnblogs.com/duhuo/articles/4762933.html</p><p>https://zhuanlan.zhihu.com/p/102895029</p><p>https://blog.csdn.net/u013066244/article/details/78961602</p><p>https://www.cnblogs.com/c-abc/p/6023824.html</p><p>https://blog.csdn.net/chigua1760/article/details/100642249</p><h2 id="bulk" tabindex="-1"><a class="header-anchor" href="#bulk" aria-hidden="true">#</a> Bulk</h2><p><a href="https://docs.mongodb.com/manual/core/bulk-write-operations/" target="_blank" rel="noopener noreferrer">Bulk</a></p><h2 id="mongodb-执行-dropdatabase-报错-not-authorized-on-xxx-to-execute-command-dropdatabase-1-0-db-xxx-解决办法" tabindex="-1"><a class="header-anchor" href="#mongodb-执行-dropdatabase-报错-not-authorized-on-xxx-to-execute-command-dropdatabase-1-0-db-xxx-解决办法" aria-hidden="true">#</a> mongodb 执行 dropDatabase 报错&quot;not authorized on xxx to execute command { dropDatabase：1.0，$db:&quot;xxx&quot;}&quot;解决办法</h2><p>https://www.jianshu.com/u/8eb1d4237939</p><p>2020.11.02 11:38:40 字数 44 阅读 40</p><p>此错误是因为没有授权给 admin 用户对 system 数据库执行命令的权限，解决方法如下:</p><p>db.grantRolesToUser ( &quot;root&quot;, [ { role: &quot;__system&quot;, db: &quot;admin&quot; } ] )</p><h2 id="mongodb-shell-script" tabindex="-1"><a class="header-anchor" href="#mongodb-shell-script" aria-hidden="true">#</a> mongodb shell script</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>var needToUpdate = []
var needToDelete = []
db.getCollection(&#39;ec.storeMemberHistory&#39;).aggregate([
    {
        &quot;$match&quot;: { &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;)}
    },
    {
        &quot;$lookup&quot;: { &quot;from&quot; : &quot;member&quot;, &quot;localField&quot;: &quot;memberId&quot;, &quot;foreignField&quot;: &quot;_id&quot;, &quot;as&quot;: &quot;member&quot;}
    },
    {
        &quot;$match&quot;: {&quot;$or&quot;:[{&quot;member.isDeleted&quot;:true},{&quot;member&quot;:{&quot;$size&quot;:0}}]}
    }
]).forEach(function(history){
    var hasMergeHistory = false;
    db.getCollection(&#39;memberMergeHistory&#39;).aggregate([
        {
            &quot;$match&quot;: { &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;),&quot;mergedMemberIds&quot; : {&quot;$in&quot;:[history.memberId]} }
        },
    ]).forEach(function(mergeHistory){
        hasMergeHistory = true;
        db.getCollection(&#39;ec.storeMemberHistory&#39;).find({
                &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;),
                &quot;memberId&quot;: history.memberId
        }).forEach(function(doc){
             db.getCollection(&#39;ec.storeMemberHistory&#39;).update({_id:doc._id},{&quot;$set&quot;: { &quot;memberId&quot; : mergeHistory.mainMemberId}})
        })
    })
    if (hasMergeHistory){
        needToUpdate.push(history.memberId);
    } else{
        needToDelete.push(history.memberId);
    }
})
needToDelete.forEach(function(memberId){
    db.getCollection(&#39;ec.storeMemberHistory&#39;).remove({
        &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;),
        &quot;memberId&quot; : memberId
    })
})
print(&quot;need update count:&quot; + needToUpdate.length)
print(&quot;need delete count:&quot; + needToDelete.length)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>var needToUpdate = []
var needToDelete = []
db.getCollection(&#39;ec.storeMember&#39;).aggregate([
    {
        &quot;$match&quot;: { &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;), &quot;isDeleted&quot;: false }
    },
    {
        &quot;$lookup&quot;: { &quot;from&quot; : &quot;member&quot;, &quot;localField&quot;: &quot;memberId&quot;, &quot;foreignField&quot;: &quot;_id&quot;, &quot;as&quot;: &quot;member&quot;}
    },
    {
        &quot;$match&quot;: {&quot;$or&quot;:[{&quot;member.isDeleted&quot;:true},{&quot;member&quot;:{&quot;$size&quot;:0}}]}
    }
]).forEach(function(storeMember){
    var hasMergeHistory = false;
    db.getCollection(&#39;memberMergeHistory&#39;).aggregate([
        {
            &quot;$match&quot;: { &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;),&quot;mergedMemberIds&quot; : {&quot;$in&quot;:[storeMember.memberId]} }
        },
    ]).forEach(function(mergeHistory){
        hasMergeHistory = true;
        db.getCollection(&#39;ec.storeMember&#39;).find({
                &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;),
                &quot;memberId&quot;: storeMember.memberId,
                &quot;isDeleted&quot;: false
        }).forEach(function(doc){
             db.getCollection(&#39;ec.storeMember&#39;).update({_id:doc._id},{&quot;$set&quot;: { &quot;memberId&quot; : mergeHistory.mainMemberId}})
        })
    })
    if (hasMergeHistory){
        needToUpdate.push(storeMember.memberId);
    } else{
        needToDelete.push(storeMember.memberId);
    }
})
needToDelete.forEach(function(memberId){
    db.getCollection(&#39;ec.storeMember&#39;).update({
        &quot;accountId&quot; : ObjectId(&quot;5964866695ee5651741a91a2&quot;),
        &quot;memberId&quot; : memberId
    },{&quot;$set&quot;: { &quot;isDeleted&quot; : true}})
})

print(&quot;update count:&quot; + needToUpdate.length)
print(&quot;delete count:&quot; + needToDelete.length)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>db.getCollection(&#39;ec.storeMemberHistory&#39;).aggregate([
    { &quot;$match&quot;: { &quot;accountId&quot;: ObjectId(&#39;5e7872a773ee1200fb1bec32&#39;), &quot;relation&quot;: &quot;bound&quot; } },
    { &quot;$sort&quot;: { &quot;createdAt&quot;: -1 } },
    { &quot;$group&quot;: {
        &quot;_id&quot;: { &quot;storeId&quot;: &quot;$storeId&quot;, &quot;staffId&quot;: &quot;$staffId&quot;, &quot;memberId&quot;: &quot;$memberId&quot; },
        &quot;createdAt&quot;: { &quot;$first&quot;: &quot;$createdAt&quot; },
      },
    },
  ]).forEach(function (history) {
    db.getCollection(&#39;ec.storeMember&#39;).update(
      {
        &quot;accountId&quot;: ObjectId(&#39;5e7872a773ee1200fb1bec32&#39;),
        &quot;memberId&quot;: history._id.memberId,
        &quot;isDeleted&quot;: false,
        &quot;stores&quot;: { &quot;$elemMatch&quot;: { &quot;staffId&quot;: history._id.staffId, &quot;storeId&quot;: history._id.storeId } },
      },
      { &quot;$set&quot;: { &quot;stores.$.boundAt&quot;: history.createdAt } }
    );
  });
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>db.getCollection(&#39;ec.storeMember&#39;).aggregate([
    {&quot;$match&quot;:{&quot;accountId&quot;: ObjectId(&quot;5e7872a773ee1200fb1bec32&quot;)}},
    {
        &quot;$redact&quot;:{
            &quot;$cond&quot;:{
                &quot;if&quot;:{
                    &quot;$or&quot;:[
                        &quot;$stores&quot;,
                        {
                            &quot;$and&quot;:[
                                {&quot;$in&quot;:[&quot;$relation&quot;,[&quot;touched&quot;,&quot;served&quot;]]},
                                {&quot;$lt&quot;:[&quot;$updatedAt&quot;,ISODate(&quot;2021-05-20T08:26:26.773Z&quot;)]},
                                {&quot;$gt&quot;:[&quot;$updatedAt&quot;,ISODate(&quot;2021-04-20T08:26:26.773Z&quot;)]}
                            ]
                        }
                    ]
                },
                &quot;then&quot;:&quot;$$DESCEND&quot;,
                &quot;else&quot;:&quot;$$PRUNE&quot;,
            }
        }
    },
    {&quot;$match&quot;:{&quot;stores&quot;:{&quot;$ne&quot;:[]}}}
])
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>/exportMongodbData --collection=ec.storeMember --pretty --query=&#39;{ &quot;accountId&quot; : {&quot;<span title="ParseError: KaTeX parse error: Expected &#39;EOF&#39;, got &#39;}&#39; at position 32: …d05c5b770b04e8&quot;}̲, &quot;
isDeleted&quot;:…">oid&quot;:&quot;601b460bc2d05c5b770b04e8&quot;}, &quot; isDeleted&quot;: false ,&quot;createdAt&quot; : {&quot;</span>gt&quot;:{&quot;$date&quot;:&quot;2021-01-01T01:09:28.810Z&quot;}}}&#39; --type=json portal-tenants-tongrentang</p><h2 id="副本集" tabindex="-1"><a class="header-anchor" href="#副本集" aria-hidden="true">#</a> 副本集</h2><h3 id="特点" tabindex="-1"><a class="header-anchor" href="#特点" aria-hidden="true">#</a> 特点</h3><ul><li>主节点唯一：主节点唯一，但是不固定（不确定的原因是：主节点挂了的话，会重新选举出一个主节点）</li><li>大多数原则：大多数原则，即1/2原则，一个复制集集群中，如果有大于等于1/2的节点不可用的话，那么整个进群将不可写，只可读</li><li>从库无法写入</li><li>副本集可以自动进行容灾</li></ul><h3 id="搭建" tabindex="-1"><a class="header-anchor" href="#搭建" aria-hidden="true">#</a> 搭建</h3><h4 id="前置" tabindex="-1"><a class="header-anchor" href="#前置" aria-hidden="true">#</a> 前置</h4><ul><li><p>系统 Ubuntu Server 18.04</p></li><li><p>版本 mongodb 4.2.15</p></li><li><p>角色分配</p><table><thead><tr><th style="text-align:center;">xxx</th><th style="text-align:center;">xxx</th><th style="text-align:center;">xxx</th></tr></thead><tbody><tr><td style="text-align:center;">Primary</td><td style="text-align:center;">&lt;host1&gt;:27017</td><td style="text-align:center;">主节点 负责读写</td></tr><tr><td style="text-align:center;">Secondary</td><td style="text-align:center;">&lt;host2&gt;:27017</td><td style="text-align:center;">从节点,负责容灾,主节点挂掉,则从节点成为主节点</td></tr><tr><td style="text-align:center;">Arbiter</td><td style="text-align:center;">&lt;host1&gt;:27017</td><td style="text-align:center;">投票节点,不负责数据的存储读写,存在的意义是,遵循下mongo复制集的1/2原则</td></tr></tbody></table></li></ul><h4 id="安装-1" tabindex="-1"><a class="header-anchor" href="#安装-1" aria-hidden="true">#</a> 安装</h4><p>配置</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>storage:
  dbPath: /var/lib/mongodb #mongo 数据目录
  journal:
    enabled: true
systemLog:
  destination: file
  logAppend: true
  path: /var/log/mongodb/mongod.log #日志目录
net:
  port: 27017
  bindIp: 0.0.0.0
processManagement:
  timeZoneInfo: /usr/share/zoneinfo
security:
  keyFile: /var/lib/mongodb/auth.key
  authorization: enabled
replication:
  replSetName: rs0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>dockerfile</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>FROM mongo:4.2.17-bionic

COPY config/auth.key /app/auth.key
RUN chown -R mongodb:mongodb /app/auth.key
RUN chmod 600 /app/auth.key #必须设置秘钥文件权限
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>docker-compose.yml</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>version: &#39;3&#39;
services:
  alomerry-mongodb-rs1:
    image: mongo-replset-4.2.17-bionic
    volumes:
      - /home/ubuntu/document/mongodb/db/rs1:/var/lib/mongodb:rw
      - /home/ubuntu/document/mongodb/log/rs1:/var/log/mongodb:rw
      - /home/ubuntu/document/mongodb/config:/var/lib/mongodb/config:ro
    command: --keyFile /app/auth.key --replSet rs0 --dbpath /var/lib/mongodb
    ports:
      - 27018:27017
    environment:
      MONGO_INITDB_ROOT_USERNAME: alomerry
      MONGO_INITDB_ROOT_PASSWORD: WjC120211
    logging:
      driver: json-file
      options:
        max-file: &#39;2&#39;
        max-size: 100m
  alomerry-mongodb-rs2:
    image: mongo-replset-4.2.17-bionic
    volumes:
      - /home/ubuntu/document/mongodb/db/rs2:/var/lib/mongodb:rw
      - /home/ubuntu/document/mongodb/log/rs1:/var/log/mongodb:rw
      - /home/ubuntu/document/mongodb/config:/var/lib/mongodb/config:ro
    command: --keyFile /app/auth.key --replSet rs0 --dbpath /var/lib/mongodb --auth
    ports:
      - 27019:27017
    environment:
      MONGO_INITDB_ROOT_USERNAME: alomerry
      MONGO_INITDB_ROOT_PASSWORD: WjC120211
    logging:
      driver: json-file
      options:
        max-file: &#39;2&#39;
        max-size: 100m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="添加" tabindex="-1"><a class="header-anchor" href="#添加" aria-hidden="true">#</a> 添加</h3></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg><a class="external-link meta-item-label" href="https://github.com/Alomerry/blog/edit/master/blog/posts/2021-05-22-mongodb.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--]--><!----><span>Edit this page on GitHub</span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><!----><!--[--><div class="pager"><a href="/posts/2021-03-15-postman.html" class="previous">Previous<br><span>Postman 使用技巧</span></a><a href="/posts/2021-06-23-grpc.html" class="next">Next<br><span>gRPC</span></a></div><!--]--><!----></main><ul class="catalog" style="top:0px;"><li class="level-2 toc-link-transacation-4-2">Transacation 4.2</li><li class="level-2 toc-link-install-mongodb-4-2">Install mongodb 4.2</li><li class="level-3 toc-link-ubuntu-18-04">Ubuntu 18.04</li><li class="level-4 toc-link-卸载">卸载</li><li class="level-4 toc-link-停止">停止</li><li class="level-4 toc-link-删除数据">删除数据</li><li class="level-4 toc-link-安装">安装</li><li class="level-5 toc-link-import-the-public-key-used-by-the-package-management-system">Import the public key used by the package management system</li><li class="level-5 toc-link-create-a-list-file-for-mongodb">Create a list file for MongoDB</li><li class="level-4 toc-link-启动">启动</li><li class="level-4 toc-link-查看状态">查看状态</li><li class="level-5 toc-link-创建账号">创建账号</li><li class="level-5 toc-link-远程连接">远程连接</li><li class="level-2 toc-link-export-and-import">export And import</li><li class="level-2 toc-link-go-mongodb-driver-2020-09-30">go-mongodb-driver (2020/09/30)</li><li class="level-3 toc-link-clientoptions">ClientOptions</li><li class="level-4 toc-link-appname">AppName</li><li class="level-4 toc-link-auth">Auth</li><li class="level-4 toc-link-compressors">Compressors</li><li class="level-4 toc-link-connecttimeout">ConnectTimeout</li><li class="level-4 toc-link-dialer">Dialer</li><li class="level-4 toc-link-direct">Direct</li><li class="level-4 toc-link-heartbeatinterval">HeartbeatInterval</li><li class="level-4 toc-link-hosts">Hosts</li><li class="level-4 toc-link-localthreshold">LocalThreshold</li><li class="level-4 toc-link-maxconnidletime">MaxConnIdleTime</li><li class="level-4 toc-link-maxpoolsize">MaxPoolSize</li><li class="level-4 toc-link-minpoolsize">MinPoolSize</li><li class="level-4 toc-link-poolmonitor">PoolMonitor</li><li class="level-4 toc-link-monitor">Monitor</li><li class="level-4 toc-link-readconcern">ReadConcern</li><li class="level-4 toc-link-readpreference">ReadPreference</li><li class="level-4 toc-link-registry">Registry</li><li class="level-4 toc-link-replicaset">ReplicaSet</li><li class="level-4 toc-link-retrywrites">RetryWrites</li><li class="level-4 toc-link-retryreads">RetryReads</li><li class="level-4 toc-link-serverselectiontimeout">ServerSelectionTimeout</li><li class="level-4 toc-link-sockettimeout">SocketTimeout</li><li class="level-4 toc-link-tlsconfig">TLSConfig</li><li class="level-4 toc-link-writeconcern">WriteConcern</li><li class="level-4 toc-link-zliblevel">ZlibLevel</li><li class="level-4 toc-link-zstdlevel">ZstdLevel</li><li class="level-4 toc-link-autoencryptionoptions">AutoEncryptionOptions</li><li class="level-4 toc-link-disableocspendpointcheck">DisableOCSPEndpointCheck</li><li class="level-2 toc-link-常用命令">常用命令</li><li class="level-3 toc-link-ubuntu-使用-systemctl-命令强制密码验证登录">Ubuntu 使用 Systemctl 命令强制密码验证登录</li><li class="level-3 toc-link-预定义角色">预定义角色</li><li class="level-2 toc-link-索引">索引</li><li class="level-2 toc-link-bulk">Bulk</li><li class="level-2 toc-link-mongodb-执行-dropdatabase-报错-not-authorized-on-xxx-to-execute-command-dropdatabase-1-0-db-xxx-解决办法">mongodb 执行 dropDatabase 报错&quot;not authorized on xxx to execute command { dropDatabase：1.0，$db:&quot;xxx&quot;}&quot;解决办法</li><li class="level-2 toc-link-mongodb-shell-script">mongodb shell script</li><li class="level-2 toc-link-副本集">副本集</li><li class="level-3 toc-link-特点">特点</li><li class="level-3 toc-link-搭建">搭建</li><li class="level-4 toc-link-前置">前置</li><li class="level-4 toc-link-安装-1">安装</li><li class="level-3 toc-link-添加">添加</li></ul></div><!--]--></div><div class="search-page" role="search"><span class="search-close"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512" width="28" height="28" fill="currentColor"><path d="M224 416c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L224 338.8l169.4-169.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-192 192C240.4 412.9 232.2 416 224 416z"></path></svg></span><div class="gungnir-search-box"><input placeholder="$ grep ..." autocomplete="off" spellcheck="false" value><!----></div></div><div class="menu-btn-container"><div class="menu-btn-wrapper"><div class="menu-btn"><div style="" class="menu-btn-icon"><span></span><span></span><span></span></div><div style="display:none;" class="menu-text">0</div><svg class="menu-progress"><circle class="menu-border" cx="50%" cy="50%" r="48%" style="stroke-dasharray:0% 314.15926%;"></circle></svg></div><div class="menu-btn-child-wrapper"><div title="toggle color mode" class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"/></svg><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 00283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"/></svg><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"/></svg></div><div class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"/></svg></div><div class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"/></svg></div><div class="menu-btn-child menu-toc-btn"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M48 48a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm448 16H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16zm0-320H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16V80a16 16 0 00-16-16zm0 160H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16z"/></svg></div><div class="toggle-sidebar-button menu-btn-child menu-btn-sidebar" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path d="M14 2a1 1 0 011 1v10a1 1 0 01-1 1H2a1 1 0 01-1-1V3a1 1 0 011-1h12zM2 1a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V3a2 2 0 00-2-2H2z"/><path d="M3 4a1 1 0 011-1h2a1 1 0 011 1v8a1 1 0 01-1 1H4a1 1 0 01-1-1V4z"/></svg></div></div></div></div><footer class="footer"><span>
      &copy; <a href="https://github.com/Alomerry" target="_blank">Alomerry Wu</a> 2018-2022
      <br>
      Powered by <a href="https://v2.vuepress.vuejs.org" target="_blank">VuePress</a> &
      <a href="https://github.com/Renovamen/vuepress-theme-gungnir" target="_blank">Gungnir</a>
    </span></footer></div><!--]--></div>
    <script type="module" src="/assets/app.a324704d.js" defer></script>
  </body>
</html>
